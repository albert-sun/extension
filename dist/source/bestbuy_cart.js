(()=>{"use strict";var t,e={9705:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function u(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(9416),r=n(1209);let u,c={},s={notificationSoundURL:function(){return o(this,void 0,void 0,(function*(){u=new Audio(c.notificationSoundURL.value)}))}},a={updatedSetting:function(t,e){return o(this,void 0,void 0,(function*(){const[n,o]=t.split("-");"bestbuy"===n&&(c[o]=e,yield s[o]())}))},testNotificationSound:function(){return o(this,void 0,void 0,(function*(){u.play()}))}},l=[];!function(){o(this,void 0,void 0,(function*(){c=yield r.retrieveSettingsKV("bestbuy"),yield s.notificationSoundURL(),i.browser.runtime.onMessage.addListener((function(t,e){return o(this,void 0,void 0,(function*(){const e=a[t.instruction];if(void 0!==e)return yield e(...t.arguments||[])}))}));const t={data:atob(localStorage.getItem("purchaseTracker")||"e30="),time:Number(new Date)};yield i.browser.storage.local.set({"bestbuy-queueInfo":t}),i.browser.runtime.sendMessage({instruction:"updatedQueueInfo",arguments:[t]}),yield function(){return o(this,void 0,void 0,(function*(){for(;;)if(!1===l.some((t=>$.contains(document.body,t.wrapper)))){let t=$(".saved-items__card-wrapper").toArray();for(;0===t.length;)yield r.sleep(c.globalPollingInterval.value),t=$(".saved-items__card-wrapper").toArray();l=t.map((function(t){return{wrapper:t,sku:t.getAttribute("data-test-saved-sku"),description:$(t).find(".simple-item__description")[0].innerText,addButton:$(t).find(".btn")[0]}}))}}))}()}))}()},8681:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.defaultSettings=void 0,e.defaultSettings={bestbuy:[{key:"automaticQueueFix",description:"Attempt to automatically fix broken queues",type:"slideSwitch",value:!0},{key:"autoClickWhitelisted",description:"Automatically click whitelisted ATC buttons",type:"slideSwitch",value:!0},{key:"stopClickCartOccupied",description:"Stop automatic clicking when cart occupied",type:"slideSwitch",value:!0},{key:"globalPollingInterval",description:"Global content script polling interval",type:"number",extraText:"ms",value:100},{key:"successiveClickTimeout",description:"Timeout between successive button clicks",type:"number",extraText:"ms",value:2500},{key:"notificationSoundURL",description:"Custom notification sound URL (mp3 hotlink)",type:"text",value:"https://github.com/albert-sun/tamper-scripts/blob/main/resources/notification.mp3?raw=true"},{key:"testNotificationSound",description:"Play current notification sound",type:"button",instruction:"testNotificationSound"}]}},1209:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function u(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.retrieveSettingsKV=e.retrieveSettings=e.storageGet=e.elementColor=e.sleep=void 0;const i=n(9416),r=n(8681);e.sleep=function(t){return new Promise((e=>setTimeout(e,t)))};const u=[{color:"yellow",r:255,g:224,b:0},{color:"blue",r:0,g:30,b:115},{color:"grey",r:197,g:203,b:213},{color:"white",r:255,g:255,b:255}];function c(t,e){return o(this,void 0,void 0,(function*(){const n=yield i.browser.storage.local.get(t);return void 0!==n[t]?n[t]:e}))}function s(t){return o(this,void 0,void 0,(function*(){const e=r.defaultSettings[t];for(const n of e){if(void 0===n.value)continue;const e=`setting-${t}-${n.key}`;n.value=yield c(e,n.value)}return e}))}e.elementColor=function(t){const e=getComputedStyle(t,null).getPropertyValue("background-color");if(e.includes("rgb(0, 0, 0"))return"transparent";const n={r:0,g:0,b:0},o=e.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);n.r=Number(o[1]),n.g=Number(o[2]),n.b=Number(o[3]);const i={color:"",distance:442};for(const t of u){const e=Math.sqrt(Math.pow(n.r-t.r,2)+Math.pow(n.g-t.g,2)+(n.b-t.b));e<i.distance&&(i.color=t.color,i.distance=e)}return i.color},e.storageGet=c,e.retrieveSettings=s,e.retrieveSettingsKV=function(t){return o(this,void 0,void 0,(function*(){const e={},n=yield s(t);for(const t of n)void 0!==t.value&&(e[t.key]=t);return e}))}}},n={};function o(t){var i=n[t];if(void 0!==i)return i.exports;var r=n[t]={exports:{}};return e[t].call(r.exports,r,r.exports,o),r.exports}o.m=e,t=[],o.O=(e,n,i,r)=>{if(!n){var u=1/0;for(a=0;a<t.length;a++){for(var[n,i,r]=t[a],c=!0,s=0;s<n.length;s++)(!1&r||u>=r)&&Object.keys(o.O).every((t=>o.O[t](n[s])))?n.splice(s--,1):(c=!1,r<u&&(u=r));c&&(t.splice(a--,1),e=i())}return e}r=r||0;for(var a=t.length;a>0&&t[a-1][2]>r;a--)t[a]=t[a-1];t[a]=[n,i,r]},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.j=843,(()=>{var t={843:0,533:0,386:0};o.O.j=e=>0===t[e];var e=(e,n)=>{var i,r,[u,c,s]=n,a=0;for(i in c)o.o(c,i)&&(o.m[i]=c[i]);if(s)var l=s(o);for(e&&e(n);a<u.length;a++)r=u[a],o.o(t,r)&&t[r]&&t[r][0](),t[u[a]]=0;return o.O(l)},n=self.webpackChunkextension=self.webpackChunkextension||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var i=o.O(void 0,[736],(()=>o(9705)));i=o.O(i)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leHRlbnNpb24vd2VicGFjay9ydW50aW1lL2NodW5rIGxvYWRlZCIsIndlYnBhY2s6Ly9leHRlbnNpb24vLi9zb3VyY2UvYmVzdGJ1eV9jYXJ0LnRzIiwid2VicGFjazovL2V4dGVuc2lvbi8uL3NvdXJjZS9jb25zdGFudHMudHMiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uLy4vc291cmNlL3V0aWxpdGllcy50cyIsIndlYnBhY2s6Ly9leHRlbnNpb24vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovL2V4dGVuc2lvbi93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9ydW50aW1lSWQiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL2V4dGVuc2lvbi93ZWJwYWNrL3N0YXJ0dXAiXSwibmFtZXMiOlsiZGVmZXJyZWQiLCJfX2F3YWl0ZXIiLCJ0aGlzIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsIndlYmV4dGVuc2lvbl9wb2x5ZmlsbF90c18xIiwidXRpbGl0aWVzXzEiLCJub3RpZmljYXRpb25Tb3VuZCIsImNhdGVnb3J5U2V0dGluZ3MiLCJ1cGRhdGVkU2V0dGluZ0hhbmRsZXJzIiwiQXVkaW8iLCJtZXNzYWdlSGFuZGxlcnMiLCJmdWxsU2V0dGluZ3NLZXkiLCJjYXRlZ29yeSIsInNldHRpbmdzS2V5Iiwic3BsaXQiLCJwbGF5Iiwic2F2ZWRJdGVtcyIsInJldHJpZXZlU2V0dGluZ3NLViIsImJyb3dzZXIiLCJydW50aW1lIiwib25NZXNzYWdlIiwiYWRkTGlzdGVuZXIiLCJtZXNzYWdlIiwic2VuZGVyIiwiaGFuZGxlciIsImluc3RydWN0aW9uIiwidW5kZWZpbmVkIiwiYXJndW1lbnRzIiwicXVldWVJbmZvIiwiZGF0YSIsImF0b2IiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwidGltZSIsIk51bWJlciIsIkRhdGUiLCJzdG9yYWdlIiwibG9jYWwiLCJzZXQiLCJzZW5kTWVzc2FnZSIsInNvbWUiLCJpdGVtRGF0YSIsIiQiLCJjb250YWlucyIsImRvY3VtZW50IiwiYm9keSIsIndyYXBwZXIiLCJzYXZlZEVsZW1lbnRzIiwidG9BcnJheSIsImxlbmd0aCIsInNsZWVwIiwibWFwIiwiZWxlbWVudCIsInNrdSIsImdldEF0dHJpYnV0ZSIsImRlc2NyaXB0aW9uIiwiZmluZCIsImlubmVyVGV4dCIsImFkZEJ1dHRvbiIsInNhdmVkQ2FydFJ1bnRpbWUiLCJkZWZhdWx0U2V0dGluZ3MiLCJrZXkiLCJ0eXBlIiwiZXh0cmFUZXh0IiwicmV0cmlldmVTZXR0aW5ncyIsInN0b3JhZ2VHZXQiLCJlbGVtZW50Q29sb3IiLCJjb25zdGFudHNfMSIsIm1zIiwic2V0VGltZW91dCIsImNvbG9ycyIsImNvbG9yIiwiciIsImciLCJiIiwic3RvcmFnZUtleSIsImRlZmF1bHRWYWx1ZSIsInN0b3JhZ2VSZXN1bHQiLCJnZXQiLCJzZXR0aW5nc0NhdGVnb3J5Iiwic2V0dGluZyIsInNldHRpbmdLZXkiLCJjb2xvclRleHQiLCJnZXRDb21wdXRlZFN0eWxlIiwiZ2V0UHJvcGVydHlWYWx1ZSIsImluY2x1ZGVzIiwicGFyc2VkQ29sb3IiLCJtYXRjaGVkQ29sb3IiLCJtYXRjaCIsImNsb3Nlc3QiLCJkaXN0YW5jZSIsImNoZWNrQ29sb3IiLCJNYXRoIiwic3FydCIsInBvdyIsImNhdGVnb3J5U2V0dGluZ3NLViIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIiwibSIsIk8iLCJjaHVua0lkcyIsImZuIiwicHJpb3JpdHkiLCJub3RGdWxmaWxsZWQiLCJJbmZpbml0eSIsImkiLCJqIiwia2V5cyIsImV2ZXJ5Iiwic3BsaWNlIiwibiIsImdldHRlciIsIl9fZXNNb2R1bGUiLCJkIiwiYSIsImRlZmluaXRpb24iLCJvIiwiZW51bWVyYWJsZSIsImdsb2JhbFRoaXMiLCJGdW5jdGlvbiIsIndpbmRvdyIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwiaW5zdGFsbGVkQ2h1bmtzIiwiY2h1bmtJZCIsIndlYnBhY2tKc29ucENhbGxiYWNrIiwicGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24iLCJtb3JlTW9kdWxlcyIsImNodW5rTG9hZGluZ0dsb2JhbCIsInNlbGYiLCJmb3JFYWNoIiwiYmluZCIsInB1c2giLCJfX3dlYnBhY2tfZXhwb3J0c19fIl0sIm1hcHBpbmdzIjoidUJBQUlBLEUsd0JDQ0osSUFBSUMsRUFBYUMsTUFBUUEsS0FBS0QsV0FBYyxTQUFVRSxFQUFTQyxFQUFZQyxFQUFHQyxHQUUxRSxPQUFPLElBQUtELElBQU1BLEVBQUlFLFdBQVUsU0FBVUMsRUFBU0MsR0FDL0MsU0FBU0MsRUFBVUMsR0FBUyxJQUFNQyxFQUFLTixFQUFVTyxLQUFLRixJQUFXLE1B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Qk0sS0FBSyxLQUFNLElBQzNESCxFQUFtQkksS0FBT1AsRUFBcUJNLEtBQUssS0FBTUgsRUFBbUJJLEtBQUtELEtBQUtILEssR0M3Q3ZGLElBQUlLLEVBQXNCN0MsRUFBb0JPLE9BQUU5RSxFQUFXLENBQUMsTUFBTSxJQUFPdUUsRUFBb0IsUUFDN0Y2QyxFQUFzQjdDLEVBQW9CTyxFQUFFc0MsSSIsImZpbGUiOiJzb3VyY2UvYmVzdGJ1eV9jYXJ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGRlZmVycmVkID0gW107XG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8gPSAocmVzdWx0LCBjaHVua0lkcywgZm4sIHByaW9yaXR5KSA9PiB7XG5cdGlmKGNodW5rSWRzKSB7XG5cdFx0cHJpb3JpdHkgPSBwcmlvcml0eSB8fCAwO1xuXHRcdGZvcih2YXIgaSA9IGRlZmVycmVkLmxlbmd0aDsgaSA+IDAgJiYgZGVmZXJyZWRbaSAtIDFdWzJdID4gcHJpb3JpdHk7IGktLSkgZGVmZXJyZWRbaV0gPSBkZWZlcnJlZFtpIC0gMV07XG5cdFx0ZGVmZXJyZWRbaV0gPSBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV07XG5cdFx0cmV0dXJuO1xuXHR9XG5cdHZhciBub3RGdWxmaWxsZWQgPSBJbmZpbml0eTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkZWZlcnJlZC5sZW5ndGg7IGkrKykge1xuXHRcdHZhciBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV0gPSBkZWZlcnJlZFtpXTtcblx0XHR2YXIgZnVsZmlsbGVkID0gdHJ1ZTtcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGNodW5rSWRzLmxlbmd0aDsgaisrKSB7XG5cdFx0XHRpZiAoKHByaW9yaXR5ICYgMSA9PT0gMCB8fCBub3RGdWxmaWxsZWQgPj0gcHJpb3JpdHkpICYmIE9iamVjdC5rZXlzKF9fd2VicGFja19yZXF1aXJlX18uTykuZXZlcnkoKGtleSkgPT4gKF9fd2VicGFja19yZXF1aXJlX18uT1trZXldKGNodW5rSWRzW2pdKSkpKSB7XG5cdFx0XHRcdGNodW5rSWRzLnNwbGljZShqLS0sIDEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZnVsZmlsbGVkID0gZmFsc2U7XG5cdFx0XHRcdGlmKHByaW9yaXR5IDwgbm90RnVsZmlsbGVkKSBub3RGdWxmaWxsZWQgPSBwcmlvcml0eTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYoZnVsZmlsbGVkKSB7XG5cdFx0XHRkZWZlcnJlZC5zcGxpY2UoaS0tLCAxKVxuXHRcdFx0cmVzdWx0ID0gZm4oKTtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHJlc3VsdDtcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCB3ZWJleHRlbnNpb25fcG9seWZpbGxfdHNfMSA9IHJlcXVpcmUoXCJ3ZWJleHRlbnNpb24tcG9seWZpbGwtdHNcIik7XHJcbmNvbnN0IHV0aWxpdGllc18xID0gcmVxdWlyZShcIi4vdXRpbGl0aWVzXCIpO1xyXG5sZXQgY2F0ZWdvcnlTZXR0aW5ncyA9IHt9O1xyXG5sZXQgdXBkYXRlZFNldHRpbmdIYW5kbGVycyA9IHtcclxuICAgIFwibm90aWZpY2F0aW9uU291bmRVUkxcIjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvblNvdW5kID0gbmV3IEF1ZGlvKGNhdGVnb3J5U2V0dGluZ3NbXCJub3RpZmljYXRpb25Tb3VuZFVSTFwiXS52YWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07IC8vIEhhbmRsZXJzIGZvciB3aGVuIHNldHRpbmdzIGFyZSB1cGRhdGVkIHdpdGhvdXQgcmVxdWlyaW5nIHJlbG9hZFxyXG5sZXQgbWVzc2FnZUhhbmRsZXJzID0ge1xyXG4gICAgXCJ1cGRhdGVkU2V0dGluZ1wiOiBmdW5jdGlvbiAoZnVsbFNldHRpbmdzS2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgY2F0ZWdvcnkgaXMgY29ycmVjdCwgdXBkYXRlIHNldHRpbmcgdGhlbiBjYWxsIGhhbmRsZXJcclxuICAgICAgICAgICAgY29uc3QgW2NhdGVnb3J5LCBzZXR0aW5nc0tleV0gPSBmdWxsU2V0dGluZ3NLZXkuc3BsaXQoXCItXCIpO1xyXG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09IFwiYmVzdGJ1eVwiKSB7XHJcbiAgICAgICAgICAgICAgICBjYXRlZ29yeVNldHRpbmdzW3NldHRpbmdzS2V5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgeWllbGQgdXBkYXRlZFNldHRpbmdIYW5kbGVyc1tzZXR0aW5nc0tleV0oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIFwidGVzdE5vdGlmaWNhdGlvblNvdW5kXCI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgeyBub3RpZmljYXRpb25Tb3VuZC5wbGF5KCk7IH0pO1xyXG4gICAgfVxyXG59O1xyXG5sZXQgbm90aWZpY2F0aW9uU291bmQ7XHJcbmxldCBzYXZlZEl0ZW1zID0gW107XHJcbi8vIENhcnQgcGFnZSBzYXZlZCBpdGVtcyBydW50aW1lIC0gcGVyaW9kaWNhbGx5IHBvbGxzIGVsZW1lbnRzIGZvciBjb2xvciBhbmQgY2xpY2thYmlsaXR5XHJcbmZ1bmN0aW9uIHNhdmVkQ2FydFJ1bnRpbWUoKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIC8vIEtlZXAgbG9vcCBydW5uaW5nIHdoaWxlIHBhZ2UgaXMgbG9hZGVkXHJcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgd2hldGhlciBzYXZlZCBpdGVtIGJ1dHRvbnMgc3RpbGwgZXhpc3QgaW4gRE9NXHJcbiAgICAgICAgICAgIGNvbnN0IHN0aWxsRXhpc3RzID0gc2F2ZWRJdGVtcy5zb21lKGl0ZW1EYXRhID0+ICQuY29udGFpbnMoZG9jdW1lbnQuYm9keSwgaXRlbURhdGEud3JhcHBlcikpO1xyXG4gICAgICAgICAgICBpZiAoc3RpbGxFeGlzdHMgPT09IGZhbHNlKSB7IC8vIFNhdmVkIGl0ZW1zIHByb2JhYmx5IHJlbG9hZCwgcmUtc2NyYXBlXHJcbiAgICAgICAgICAgICAgICBsZXQgc2F2ZWRFbGVtZW50cyA9ICQoXCIuc2F2ZWQtaXRlbXNfX2NhcmQtd3JhcHBlclwiKS50b0FycmF5KCk7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoc2F2ZWRFbGVtZW50cy5sZW5ndGggPT09IDApIHsgLy8gV2FpdCB1bnRpbCBzYXZlZCBpdGVtcyBlbGVtZW50cyBleGlzdFxyXG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIHV0aWxpdGllc18xLnNsZWVwKGNhdGVnb3J5U2V0dGluZ3NbXCJnbG9iYWxQb2xsaW5nSW50ZXJ2YWxcIl0udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVkRWxlbWVudHMgPSAkKFwiLnNhdmVkLWl0ZW1zX19jYXJkLXdyYXBwZXJcIikudG9BcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gRGlzZ3VzdGluZyB3YXkgdG8gbWFwIGVsZW1lbnRzLCBjYW4ndCBhcnJvdyBtYXAgdG8gaW50ZXJmYWNlIGFwcGFyZW50bHlcclxuICAgICAgICAgICAgICAgIHNhdmVkSXRlbXMgPSBzYXZlZEVsZW1lbnRzLm1hcChmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyYXBwZXI6IGVsZW1lbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNrdTogZWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXRlc3Qtc2F2ZWQtc2t1XCIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJChlbGVtZW50KS5maW5kKFwiLnNpbXBsZS1pdGVtX19kZXNjcmlwdGlvblwiKVswXS5pbm5lclRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEJ1dHRvbjogJChlbGVtZW50KS5maW5kKFwiLmJ0blwiKVswXSxcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gU2F2ZWQgaXRlbXMgc3RpbGwgbG9hZGVkIG9yIHJlLXNjcmFwZWQsIGl0ZXJhdGUgb3ZlclxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcbi8vIEFzeW5jaHJvbm91cyBtYWluIGNvbnRlbnQgc2NyaXB0IHJ1bnRpbWVcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgLy8gUmV0cmlldmUgdXBkYXRlZCBzZXR0aW5ncyBmcm9tIFN0b3JhZ2UgQVBJIGFuZCBpbml0aWFsaXplXHJcbiAgICAgICAgY2F0ZWdvcnlTZXR0aW5ncyA9IHlpZWxkIHV0aWxpdGllc18xLnJldHJpZXZlU2V0dGluZ3NLVihcImJlc3RidXlcIik7XHJcbiAgICAgICAgeWllbGQgdXBkYXRlZFNldHRpbmdIYW5kbGVyc1tcIm5vdGlmaWNhdGlvblNvdW5kVVJMXCJdKCk7XHJcbiAgICAgICAgLy8gU2V0dXAgbWVzc2FnZSBsaXN0ZW5lciBtYWlubHkgZm9yIHVwZGF0ZWQgc2V0dGluZ3NcclxuICAgICAgICB3ZWJleHRlbnNpb25fcG9seWZpbGxfdHNfMS5icm93c2VyLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKGZ1bmN0aW9uIChtZXNzYWdlLCBzZW5kZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgaGFuZGxlciB3aXRoIHByb3ZpZGVkIGFyZ3VtZW50cyBhbmQgcmVzcG9uZCBpZiBuZWNlc3NhcnlcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSBtZXNzYWdlSGFuZGxlcnNbbWVzc2FnZS5pbnN0cnVjdGlvbl07XHJcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlciAhPT0gdW5kZWZpbmVkKSB7IC8vIENoZWNrIHdoZXRoZXIgZ2l2ZW4gaGFuZGxlciBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB5aWVsZCBoYW5kbGVyKC4uLm1lc3NhZ2UuYXJndW1lbnRzIHx8IFtdKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OyAvLyBFcXVpdmFsZW50IHRvIHNlbmRSZXNwb25zZT9cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gU3RvcmUgY3VycmVudCBxdWV1ZSBkYXRhIGFsb25nIHdpdGggdGltZXN0YW1wXHJcbiAgICAgICAgY29uc3QgcXVldWVJbmZvID0ge1xyXG4gICAgICAgICAgICBkYXRhOiBhdG9iKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicHVyY2hhc2VUcmFja2VyXCIpIHx8IFwiZTMwPVwiKSxcclxuICAgICAgICAgICAgdGltZTogTnVtYmVyKG5ldyBEYXRlKCkpLFxyXG4gICAgICAgIH07IC8vIFwiTGFzdCB1cGRhdGVkXCIgdGltZXN0YW1wIGZvciBleHRlbnNpb25cclxuICAgICAgICB5aWVsZCB3ZWJleHRlbnNpb25fcG9seWZpbGxfdHNfMS5icm93c2VyLnN0b3JhZ2UubG9jYWwuc2V0KHsgXCJiZXN0YnV5LXF1ZXVlSW5mb1wiOiBxdWV1ZUluZm8gfSk7XHJcbiAgICAgICAgd2ViZXh0ZW5zaW9uX3BvbHlmaWxsX3RzXzEuYnJvd3Nlci5ydW50aW1lLnNlbmRNZXNzYWdlKHsgXCJpbnN0cnVjdGlvblwiOiBcInVwZGF0ZWRRdWV1ZUluZm9cIiwgXCJhcmd1bWVudHNcIjogW3F1ZXVlSW5mb10gfSk7XHJcbiAgICAgICAgeWllbGQgc2F2ZWRDYXJ0UnVudGltZSgpOyAvLyBBY3R1YWwgcnVudGltZSBmb3IgY2FydCBzdHVmZlxyXG4gICAgfSk7XHJcbn0oKSk7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuZGVmYXVsdFNldHRpbmdzID0gdm9pZCAwO1xyXG4vLyBTZXR0aW5ncyBhY3Jvc3MgYWxsIGNhdGVnb3JpZXMgZm9yIGV4dGVuc2lvblxyXG5leHBvcnRzLmRlZmF1bHRTZXR0aW5ncyA9IHtcclxuICAgIFwiYmVzdGJ1eVwiOiBbXHJcbiAgICAgICAgeyBrZXk6IFwiYXV0b21hdGljUXVldWVGaXhcIiwgZGVzY3JpcHRpb246IFwiQXR0ZW1wdCB0byBhdXRvbWF0aWNhbGx5IGZpeCBicm9rZW4gcXVldWVzXCIsIHR5cGU6IFwic2xpZGVTd2l0Y2hcIiwgdmFsdWU6IHRydWUgfSxcclxuICAgICAgICB7IGtleTogXCJhdXRvQ2xpY2tXaGl0ZWxpc3RlZFwiLCBkZXNjcmlwdGlvbjogXCJBdXRvbWF0aWNhbGx5IGNsaWNrIHdoaXRlbGlzdGVkIEFUQyBidXR0b25zXCIsIHR5cGU6IFwic2xpZGVTd2l0Y2hcIiwgdmFsdWU6IHRydWUgfSxcclxuICAgICAgICB7IGtleTogXCJzdG9wQ2xpY2tDYXJ0T2NjdXBpZWRcIiwgZGVzY3JpcHRpb246IFwiU3RvcCBhdXRvbWF0aWMgY2xpY2tpbmcgd2hlbiBjYXJ0IG9jY3VwaWVkXCIsIHR5cGU6IFwic2xpZGVTd2l0Y2hcIiwgdmFsdWU6IHRydWUgfSxcclxuICAgICAgICB7IGtleTogXCJnbG9iYWxQb2xsaW5nSW50ZXJ2YWxcIiwgZGVzY3JpcHRpb246IFwiR2xvYmFsIGNvbnRlbnQgc2NyaXB0IHBvbGxpbmcgaW50ZXJ2YWxcIiwgdHlwZTogXCJudW1iZXJcIiwgZXh0cmFUZXh0OiBcIm1zXCIsIHZhbHVlOiAxMDAgfSxcclxuICAgICAgICB7IGtleTogXCJzdWNjZXNzaXZlQ2xpY2tUaW1lb3V0XCIsIGRlc2NyaXB0aW9uOiBcIlRpbWVvdXQgYmV0d2VlbiBzdWNjZXNzaXZlIGJ1dHRvbiBjbGlja3NcIiwgdHlwZTogXCJudW1iZXJcIiwgZXh0cmFUZXh0OiBcIm1zXCIsIHZhbHVlOiAyNTAwIH0sXHJcbiAgICAgICAgeyBrZXk6IFwibm90aWZpY2F0aW9uU291bmRVUkxcIiwgZGVzY3JpcHRpb246IFwiQ3VzdG9tIG5vdGlmaWNhdGlvbiBzb3VuZCBVUkwgKG1wMyBob3RsaW5rKVwiLCB0eXBlOiBcInRleHRcIiwgdmFsdWU6IFwiaHR0cHM6Ly9naXRodWIuY29tL2FsYmVydC1zdW4vdGFtcGVyLXNjcmlwdHMvYmxvYi9tYWluL3Jlc291cmNlcy9ub3RpZmljYXRpb24ubXAzP3Jhdz10cnVlXCIgfSxcclxuICAgICAgICB7IGtleTogXCJ0ZXN0Tm90aWZpY2F0aW9uU291bmRcIiwgZGVzY3JpcHRpb246IFwiUGxheSBjdXJyZW50IG5vdGlmaWNhdGlvbiBzb3VuZFwiLCB0eXBlOiBcImJ1dHRvblwiLCBpbnN0cnVjdGlvbjogXCJ0ZXN0Tm90aWZpY2F0aW9uU291bmRcIiB9LFxyXG4gICAgXVxyXG59O1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMucmV0cmlldmVTZXR0aW5nc0tWID0gZXhwb3J0cy5yZXRyaWV2ZVNldHRpbmdzID0gZXhwb3J0cy5zdG9yYWdlR2V0ID0gZXhwb3J0cy5lbGVtZW50Q29sb3IgPSBleHBvcnRzLnNsZWVwID0gdm9pZCAwO1xyXG5jb25zdCB3ZWJleHRlbnNpb25fcG9seWZpbGxfdHNfMSA9IHJlcXVpcmUoXCJ3ZWJleHRlbnNpb24tcG9seWZpbGwtdHNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzXCIpO1xyXG4vLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy85NTEwMjEvd2hhdC1pcy10aGUtamF2YXNjcmlwdC12ZXJzaW9uLW9mLXNsZWVwXHJcbi8vIFBvc3NpYmx5IGhhcyBpc3N1ZXMgcmVzb2x2aW5nIG9uIEZpcmVmb3g/IFN0YWNrT3ZlcmZsb3cgc3VyZSBkb2Vzbid0IHRoaW5rIHNvLi4uXHJcbmZ1bmN0aW9uIHNsZWVwKG1zKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XHJcbn1cclxuZXhwb3J0cy5zbGVlcCA9IHNsZWVwO1xyXG4vLyBBcHByb3hpbWF0ZXMgdGhlIHJlbmRlcmVkIGJhY2tncm91bmQgY29sb3Igb2YgYSBnaXZlbiBlbGVtZW50IHRvIGEgZ2l2ZW4gc2V0IG9mIGNvbG9ycy5cclxuLy8gQ2hlY2tzIHdoZXRoZXIgdGhlIFwiZGlzdGFuY2VcIiBmcm9tIHRoZSBlbGVtZW50IGNvbG9yIGlzIHRyYW5zcGFyZW50IG9yIGNsb3Nlc3QgdG8gZWl0aGVyIHllbGxvdy93aGl0ZS9ibHVlLlxyXG5jb25zdCBjb2xvcnMgPSBbXHJcbiAgICB7IGNvbG9yOiBcInllbGxvd1wiLCByOiAyNTUsIGc6IDIyNCwgYjogMCB9LFxyXG4gICAgeyBjb2xvcjogXCJibHVlXCIsIHI6IDAsIGc6IDMwLCBiOiAxMTUgfSxcclxuICAgIHsgY29sb3I6IFwiZ3JleVwiLCByOiAxOTcsIGc6IDIwMywgYjogMjEzIH0sXHJcbiAgICB7IGNvbG9yOiBcIndoaXRlXCIsIHI6IDI1NSwgZzogMjU1LCBiOiAyNTUgfSxcclxuXTtcclxuZnVuY3Rpb24gZWxlbWVudENvbG9yKGVsZW1lbnQpIHtcclxuICAgIC8vIEdldCB0aGUgcmVuZGVyZWQgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgZWxlbWVudFxyXG4gICAgY29uc3QgY29sb3JUZXh0ID0gZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKFwiYmFja2dyb3VuZC1jb2xvclwiKTtcclxuICAgIGlmIChjb2xvclRleHQuaW5jbHVkZXMoXCJyZ2IoMCwgMCwgMFwiKSkgeyAvLyBlbGVtZW50IGhhcyBubyBjb2xvciA9IHRyYW5zcGFyZW50XHJcbiAgICAgICAgcmV0dXJuIFwidHJhbnNwYXJlbnRcIjtcclxuICAgIH1cclxuICAgIC8vIFBhcnNlIFJHQiB2YWx1ZSBhbmQgdXNlIGZhbmN5IG1hdGhzIHRvIGZpbmQgY2xvc2VzdCBjb2xvclxyXG4gICAgY29uc3QgcGFyc2VkQ29sb3IgPSB7IHI6IDAsIGc6IDAsIGI6IDAgfTtcclxuICAgIGNvbnN0IG1hdGNoZWRDb2xvciA9IGNvbG9yVGV4dC5tYXRjaCgvXnJnYlxccypcXChcXHMqKFxcZCspXFxzKixcXHMqKFxcZCspXFxzKixcXHMqKFxcZCspXFxzKlxcKSQvaSk7XHJcbiAgICBwYXJzZWRDb2xvci5yID0gTnVtYmVyKG1hdGNoZWRDb2xvclsxXSk7XHJcbiAgICBwYXJzZWRDb2xvci5nID0gTnVtYmVyKG1hdGNoZWRDb2xvclsyXSk7XHJcbiAgICBwYXJzZWRDb2xvci5iID0gTnVtYmVyKG1hdGNoZWRDb2xvclszXSk7XHJcbiAgICBjb25zdCBjbG9zZXN0ID0geyBjb2xvcjogXCJcIiwgZGlzdGFuY2U6IDQ0MiB9OyAvLyBEZWZhdWx0IGRpc3RhbmNlIGp1c3Qgc2xpZ2h0bHkgbGFyZ2VyIHRoYW4gbWF4XHJcbiAgICBmb3IgKGNvbnN0IGNoZWNrQ29sb3Igb2YgY29sb3JzKSB7XHJcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLnNxcnQoTWF0aC5wb3coKHBhcnNlZENvbG9yLnIgLSBjaGVja0NvbG9yLnIpLCAyKSArIE1hdGgucG93KChwYXJzZWRDb2xvci5nIC0gY2hlY2tDb2xvci5nKSwgMikgKyAocGFyc2VkQ29sb3IuYiAtIGNoZWNrQ29sb3IuYikpO1xyXG4gICAgICAgIGlmIChkaXN0YW5jZSA8IGNsb3Nlc3QuZGlzdGFuY2UpIHtcclxuICAgICAgICAgICAgY2xvc2VzdC5jb2xvciA9IGNoZWNrQ29sb3IuY29sb3I7XHJcbiAgICAgICAgICAgIGNsb3Nlc3QuZGlzdGFuY2UgPSBkaXN0YW5jZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2xvc2VzdC5jb2xvcjtcclxufVxyXG5leHBvcnRzLmVsZW1lbnRDb2xvciA9IGVsZW1lbnRDb2xvcjtcclxuLy8gV3JhcHBlciBmb3IgcmV0cmlldmluZyBmcm9tIHN0b3JhZ2Ugd2l0aCBkZWZhdWx0IHZhbHVlIGlmIHVuZGVmaW5lZFxyXG5mdW5jdGlvbiBzdG9yYWdlR2V0KHN0b3JhZ2VLZXksIGRlZmF1bHRWYWx1ZSkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBzdG9yYWdlUmVzdWx0ID0geWllbGQgd2ViZXh0ZW5zaW9uX3BvbHlmaWxsX3RzXzEuYnJvd3Nlci5zdG9yYWdlLmxvY2FsLmdldChzdG9yYWdlS2V5KTtcclxuICAgICAgICByZXR1cm4gc3RvcmFnZVJlc3VsdFtzdG9yYWdlS2V5XSAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgID8gc3RvcmFnZVJlc3VsdFtzdG9yYWdlS2V5XSA6IGRlZmF1bHRWYWx1ZTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMuc3RvcmFnZUdldCA9IHN0b3JhZ2VHZXQ7XHJcbi8vIFdyYXBwZXIgZm9yIHJldHJpZXZpbmcgc2V0dGluZ3MgZm9yIGdpdmVuIGNhdGVnb3J5IGJ5IHVwZGF0aW5nIGZyb20gU3RvcmFnZSBBUElcclxuZnVuY3Rpb24gcmV0cmlldmVTZXR0aW5ncyhzZXR0aW5nc0NhdGVnb3J5KSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIC8vIEdldCBkZWZhdWx0IHNldHRpbmdzLCB0aGVuIHVwZGF0ZSBpbmRpdmlkdWFsIHNldHRpbmdzIGZyb20gU3RvcmFnZSBBUElcclxuICAgICAgICBjb25zdCBjYXRlZ29yeVNldHRpbmdzID0gY29uc3RhbnRzXzEuZGVmYXVsdFNldHRpbmdzW3NldHRpbmdzQ2F0ZWdvcnldO1xyXG4gICAgICAgIGZvciAoY29uc3Qgc2V0dGluZyBvZiBjYXRlZ29yeVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIC8vIElnbm9yZSBzZXR0aW5ncyB3aXRob3V0IGEgdmFsdWUgKGJ1dHRvbnMgbWFpbmx5KVxyXG4gICAgICAgICAgICBpZiAoc2V0dGluZy52YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBSZXBsYWNlIHdpdGggdmFsdWUgZnJvbSBzdG9yYWdlIGlmIG1vZGlmaWVkIGV4aXN0cywgb3RoZXJ3aXNlIGtlZXAgZGVmYXVsdFxyXG4gICAgICAgICAgICBjb25zdCBzZXR0aW5nS2V5ID0gYHNldHRpbmctJHtzZXR0aW5nc0NhdGVnb3J5fS0ke3NldHRpbmcua2V5fWA7XHJcbiAgICAgICAgICAgIHNldHRpbmcudmFsdWUgPSB5aWVsZCBzdG9yYWdlR2V0KHNldHRpbmdLZXksIHNldHRpbmcudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2F0ZWdvcnlTZXR0aW5ncztcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMucmV0cmlldmVTZXR0aW5ncyA9IHJldHJpZXZlU2V0dGluZ3M7XHJcbi8vIFdyYXBwZXIgZm9yIGZvcm1hdHRpbmcgdGhlIHNldHRpbmdzIGludG8ga2V5LXZhbHVlIGluc3RlYWQgb2YgYXJyYXlcclxuZnVuY3Rpb24gcmV0cmlldmVTZXR0aW5nc0tWKHNldHRpbmdzQ2F0ZWdvcnkpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgY2F0ZWdvcnlTZXR0aW5nc0tWID0ge307XHJcbiAgICAgICAgY29uc3QgY2F0ZWdvcnlTZXR0aW5ncyA9IHlpZWxkIHJldHJpZXZlU2V0dGluZ3Moc2V0dGluZ3NDYXRlZ29yeSk7IC8vIEdldCBzZXR0aW5ncyBiZWZvcmUgcmVmb3JtYXR0aW5nXHJcbiAgICAgICAgZm9yIChjb25zdCBzZXR0aW5nIG9mIGNhdGVnb3J5U2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgLy8gSWdub3JlIHNldHRpbmdzIHdpdGhvdXQgYSB2YWx1ZSAoYnV0dG9ucyBtYWlubHkpXHJcbiAgICAgICAgICAgIGlmIChzZXR0aW5nLnZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGVnb3J5U2V0dGluZ3NLVltzZXR0aW5nLmtleV0gPSBzZXR0aW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2F0ZWdvcnlTZXR0aW5nc0tWO1xyXG4gICAgfSk7XHJcbn1cclxuZXhwb3J0cy5yZXRyaWV2ZVNldHRpbmdzS1YgPSByZXRyaWV2ZVNldHRpbmdzS1Y7XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwiLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbl9fd2VicGFja19yZXF1aXJlX18ubiA9IChtb2R1bGUpID0+IHtcblx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG5cdFx0KCkgPT4gKG1vZHVsZVsnZGVmYXVsdCddKSA6XG5cdFx0KCkgPT4gKG1vZHVsZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsIHsgYTogZ2V0dGVyIH0pO1xuXHRyZXR1cm4gZ2V0dGVyO1xufTsiLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7XG5cdGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzO1xuXHR0cnkge1xuXHRcdHJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHR9IGNhdGNoIChlKSB7XG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSByZXR1cm4gd2luZG93O1xuXHR9XG59KSgpOyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmogPSA4NDM7IiwiLy8gbm8gYmFzZVVSSVxuXG4vLyBvYmplY3QgdG8gc3RvcmUgbG9hZGVkIGFuZCBsb2FkaW5nIGNodW5rc1xuLy8gdW5kZWZpbmVkID0gY2h1bmsgbm90IGxvYWRlZCwgbnVsbCA9IGNodW5rIHByZWxvYWRlZC9wcmVmZXRjaGVkXG4vLyBbcmVzb2x2ZSwgcmVqZWN0LCBQcm9taXNlXSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbnZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG5cdDg0MzogMCxcblx0NTMzOiAwLFxuXHQzODY6IDBcbn07XG5cbi8vIG5vIGNodW5rIG9uIGRlbWFuZCBsb2FkaW5nXG5cbi8vIG5vIHByZWZldGNoaW5nXG5cbi8vIG5vIHByZWxvYWRlZFxuXG4vLyBubyBITVJcblxuLy8gbm8gSE1SIG1hbmlmZXN0XG5cbl9fd2VicGFja19yZXF1aXJlX18uTy5qID0gKGNodW5rSWQpID0+IChpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPT09IDApO1xuXG4vLyBpbnN0YWxsIGEgSlNPTlAgY2FsbGJhY2sgZm9yIGNodW5rIGxvYWRpbmdcbnZhciB3ZWJwYWNrSnNvbnBDYWxsYmFjayA9IChwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiwgZGF0YSkgPT4ge1xuXHR2YXIgW2NodW5rSWRzLCBtb3JlTW9kdWxlcywgcnVudGltZV0gPSBkYXRhO1xuXHQvLyBhZGQgXCJtb3JlTW9kdWxlc1wiIHRvIHRoZSBtb2R1bGVzIG9iamVjdCxcblx0Ly8gdGhlbiBmbGFnIGFsbCBcImNodW5rSWRzXCIgYXMgbG9hZGVkIGFuZCBmaXJlIGNhbGxiYWNrXG5cdHZhciBtb2R1bGVJZCwgY2h1bmtJZCwgaSA9IDA7XG5cdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhtb3JlTW9kdWxlcywgbW9kdWxlSWQpKSB7XG5cdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLm1bbW9kdWxlSWRdID0gbW9yZU1vZHVsZXNbbW9kdWxlSWRdO1xuXHRcdH1cblx0fVxuXHRpZihydW50aW1lKSB2YXIgcmVzdWx0ID0gcnVudGltZShfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblx0aWYocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24pIHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKGRhdGEpO1xuXHRmb3IoO2kgPCBjaHVua0lkcy5sZW5ndGg7IGkrKykge1xuXHRcdGNodW5rSWQgPSBjaHVua0lkc1tpXTtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSAmJiBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0pIHtcblx0XHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXVswXSgpO1xuXHRcdH1cblx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZHNbaV1dID0gMDtcblx0fVxuXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHJlc3VsdCk7XG59XG5cbnZhciBjaHVua0xvYWRpbmdHbG9iYWwgPSBzZWxmW1wid2VicGFja0NodW5rZXh0ZW5zaW9uXCJdID0gc2VsZltcIndlYnBhY2tDaHVua2V4dGVuc2lvblwiXSB8fCBbXTtcbmNodW5rTG9hZGluZ0dsb2JhbC5mb3JFYWNoKHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgMCkpO1xuY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2ggPSB3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIGNodW5rTG9hZGluZ0dsb2JhbC5wdXNoLmJpbmQoY2h1bmtMb2FkaW5nR2xvYmFsKSk7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBkZXBlbmRzIG9uIG90aGVyIGxvYWRlZCBjaHVua3MgYW5kIGV4ZWN1dGlvbiBuZWVkIHRvIGJlIGRlbGF5ZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHVuZGVmaW5lZCwgWzczNl0sICgpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fKDk3MDUpKSlcbl9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8oX193ZWJwYWNrX2V4cG9ydHNfXyk7XG4iXSwic291cmNlUm9vdCI6IiJ9