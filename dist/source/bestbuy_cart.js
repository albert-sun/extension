(()=>{"use strict";var e,t={9705:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function l(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,l)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(9416),r=o(1209);let s,l={},a={notificationSoundURL:function(){return n(this,void 0,void 0,(function*(){s=new Audio(l.notificationSoundURL.value)}))},whitelistKeywords:function(){return n(this,void 0,void 0,(function*(){c=l.whitelistKeywords.value.split(",").map((e=>e.trim().toLowerCase()))}))}},u={updatedSetting:function(e,t){return n(this,void 0,void 0,(function*(){const[o,n]=e.split("-");"bestbuy"===o&&(l[n].value=t,yield a[n]())}))},testNotificationSound:function(){return n(this,void 0,void 0,(function*(){s.play()}))}},c=[],d=[],f=0,p=0;!function(){n(this,void 0,void 0,(function*(){l=yield r.retrieveSettingsKV("bestbuy");for(const[e,t]of Object.entries(a))yield t();i.browser.runtime.onMessage.addListener((function(e,t){return n(this,void 0,void 0,(function*(){const t=u[e.instruction];if(void 0!==t)return yield t(...e.arguments||[])}))}));const e={data:atob(localStorage.getItem("purchaseTracker")||"e30="),time:Number(new Date)};yield i.browser.storage.local.set({"bestbuy-queueInfo":e}),i.browser.runtime.sendMessage({instruction:"updatedQueueInfo",arguments:[e]}),yield function(){return n(this,void 0,void 0,(function*(){for(;0===$(".page-heading__title").length;)yield r.sleep(l.globalPollingInterval.value);const e=$(".item-list")[0];for(f=void 0!==e?e.childNodes.length:0;;){for(;$(".page-spinner--in").length>0;)yield r.sleep(l.globalPollingInterval.value);const e=$(".item-list")[0],t=void 0!==e?e.childNodes.length:0;if(t>f&&s.play(),f=t,t>0&&!0===l.stopClickCartOccupied.value){yield r.sleep(l.globalPollingInterval.value);continue}if(!1===d.some((e=>$.contains(document.body,e.wrapper)))){let e=$(".saved-items__card-wrapper").toArray();for(;0===e.length;)yield r.sleep(l.globalPollingInterval.value),e=$(".saved-items__card-wrapper").toArray();d=e.map((function(e){return{wrapper:e,sku:e.getAttribute("data-test-saved-sku"),description:$(e).find(".simple-item__description")[0].innerText,addButton:$(e).find(".btn")[0]}})),d.length}const o=d.filter((e=>c.some((t=>""!==t&&e.description.toLowerCase().includes(t)))));for(const e of o){const t=r.elementColor(e.addButton);if(!0===["white","blue","yellow"].includes(t)){const t=Number(new Date)-p;!0===l.autoClickWhitelisted.value&&t>l.successiveClickTimeout.value&&(e.addButton.click(),p=Number(new Date))}}yield r.sleep(l.globalPollingInterval.value)}}))}()}))}()},8681:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultSettings=t.changelogs=void 0,t.changelogs=[{version:"b0.0.1",bulletpoints:['Ported most functionality from Tampermonkey script located <a href="https://github.com/albert-sun/tamper-scripts/">here</a>',"<b>Not yet implemented</b>: blacklisted keywords and buttons for testing wtihin settings (removed until settings structure finalized)","<b>Improvements from Tampermonkey script</b>: Instant settings propogation and no refresh required for cart addition or removal"]},{version:"b0.1.0",bulletpoints:["Added changelog (this tab here) and placeholder logging tab for testing","Changed extension script loading to work somewhat more dynamically"]}],t.defaultSettings={bestbuy:[{key:"automaticQueueFix",description:"Attempt to automatically fix broken queues",type:"slideSwitch",value:!0},{key:"autoClickWhitelisted",description:"Automatically click whitelisted ATC buttons",type:"slideSwitch",value:!0},{key:"stopClickCartOccupied",description:"Stop automatic clicking when cart occupied",type:"slideSwitch",value:!0},{key:"globalPollingInterval",description:"Global content script polling interval",type:"number",extraText:"ms",value:100},{key:"successiveClickTimeout",description:"Timeout between clicking unique buttons",type:"number",extraText:"ms",value:2500},{key:"notificationSoundURL",description:"Notification sound URL (mp3 hotlink)",type:"text",value:"https://github.com/albert-sun/tamper-scripts/blob/main/resources/notification.mp3?raw=true"},{key:"whitelistKeywords",description:"Whitelisted keywords (comma-separated)",type:"text",value:"3060,3060ti,3060 ti,3070,3070ti,3070 ti,3080,3080ti,3080 ti,3090"}]}},1209:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function l(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,l)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.retrieveSettingsKV=t.retrieveSettings=t.storageGet=t.elementColor=t.sleep=void 0;const i=o(9416),r=o(8681);t.sleep=function(e){return new Promise((t=>setTimeout(t,e)))};const s=[{color:"yellow",r:255,g:224,b:0},{color:"blue",r:0,g:30,b:115},{color:"grey",r:197,g:203,b:213},{color:"white",r:255,g:255,b:255}];function l(e,t){return n(this,void 0,void 0,(function*(){const o=yield i.browser.storage.local.get(e);return void 0!==o[e]?o[e]:t}))}function a(e){return n(this,void 0,void 0,(function*(){const t=r.defaultSettings[e];for(const o of t){if(void 0===o.value)continue;const t=`setting-${e}-${o.key}`;o.value=yield l(t,o.value)}return t}))}t.elementColor=function(e){const t=getComputedStyle(e,null).getPropertyValue("background-color");if(t.includes("rgb(0, 0, 0"))return"transparent";const o={r:0,g:0,b:0},n=t.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);o.r=Number(n[1]),o.g=Number(n[2]),o.b=Number(n[3]);const i={color:"",distance:442};for(const e of s){const t=Math.sqrt(Math.pow(o.r-e.r,2)+Math.pow(o.g-e.g,2)+(o.b-e.b));t<i.distance&&(i.color=e.color,i.distance=t)}return i.color},t.storageGet=l,t.retrieveSettings=a,t.retrieveSettingsKV=function(e){return n(this,void 0,void 0,(function*(){const t={},o=yield a(e);for(const e of o)void 0!==e.value&&(t[e.key]=e);return t}))}}},o={};function n(e){var i=o[e];if(void 0!==i)return i.exports;var r=o[e]={exports:{}};return t[e].call(r.exports,r,r.exports,n),r.exports}n.m=t,e=[],n.O=(t,o,i,r)=>{if(!o){var s=1/0;for(u=0;u<e.length;u++){for(var[o,i,r]=e[u],l=!0,a=0;a<o.length;a++)(!1&r||s>=r)&&Object.keys(n.O).every((e=>n.O[e](o[a])))?o.splice(a--,1):(l=!1,r<s&&(s=r));l&&(e.splice(u--,1),t=i())}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[o,i,r]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.j=843,(()=>{var e={843:0,533:0,386:0};n.O.j=t=>0===e[t];var t=(t,o)=>{var i,r,[s,l,a]=o,u=0;for(i in l)n.o(l,i)&&(n.m[i]=l[i]);if(a)var c=a(n);for(t&&t(o);u<s.length;u++)r=s[u],n.o(e,r)&&e[r]&&e[r][0](),e[s[u]]=0;return n.O(c)},o=self.webpackChunkextension=self.webpackChunkextension||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var i=n.O(void 0,[736],(()=>n(9705)));i=n.O(i)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leHRlbnNpb24vd2VicGFjay9ydW50aW1lL2NodW5rIGxvYWRlZCIsIndlYnBhY2s6Ly9leHRlbnNpb24vLi9zb3VyY2UvYmVzdGJ1eV9jYXJ0LnRzIiwid2VicGFjazovL2V4dGVuc2lvbi8uL3NvdXJjZS9jb25zdGFudHMudHMiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uLy4vc291cmNlL3V0aWxpdGllcy50cyIsIndlYnBhY2s6Ly9leHRlbnNpb24vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovL2V4dGVuc2lvbi93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9ydW50aW1lSWQiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL2V4dGVuc2lvbi93ZWJwYWNrL3N0YXJ0dXAiXSwibmFtZXMiOlsiZGVmZXJyZWQiLCJfX2F3YWl0ZXIiLCJ0aGlzIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsIndlYmV4dGVuc2lvbl9wb2x5ZmlsbF90c18xIiwidXRpbGl0aWVzXzEiLCJub3RpZmljYXRpb25Tb3VuZCIsImNhdGVnb3J5U2V0dGluZ3MiLCJ1cGRhdGVkU2V0dGluZ0hhbmRsZXJzIiwiQXVkaW8iLCJ3aGl0ZWxpc3RlZEtleXdvcmRzIiwic3BsaXQiLCJtYXAiLCJrZXl3b3JkIiwidHJpbSIsInRvTG93ZXJDYXNlIiwibWVzc2FnZUhhbmRsZXJzIiwiZnVsbFNldHRpbmdzS2V5IiwiY2F0ZWdvcnkiLCJzZXR0aW5nc0tleSIsInBsYXkiLCJzYXZlZEl0ZW1zIiwicHJldmlvdXNDYXJ0TGVuZ3RoIiwibGFzdENsaWNrZWRUaW1lIiwicmV0cmlldmVTZXR0aW5nc0tWIiwiXyIsInVwZGF0ZWRTZXR0aW5nSGFuZGxlciIsImVudHJpZXMiLCJicm93c2VyIiwicnVudGltZSIsIm9uTWVzc2FnZSIsImFkZExpc3RlbmVyIiwibWVzc2FnZSIsInNlbmRlciIsImhhbmRsZXIiLCJpbnN0cnVjdGlvbiIsInVuZGVmaW5lZCIsImFyZ3VtZW50cyIsInF1ZXVlSW5mbyIsImRhdGEiLCJhdG9iIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInRpbWUiLCJOdW1iZXIiLCJEYXRlIiwic3RvcmFnZSIsImxvY2FsIiwic2V0Iiwic2VuZE1lc3NhZ2UiLCIkIiwibGVuZ3RoIiwic2xlZXAiLCJpbml0Q2FydFdyYXBwZXIiLCJjaGlsZE5vZGVzIiwiY2FydFdyYXBwZXIiLCJjdXJyZW50Q2FydExlbmd0aCIsInNvbWUiLCJpdGVtRGF0YSIsImNvbnRhaW5zIiwiZG9jdW1lbnQiLCJib2R5Iiwid3JhcHBlciIsInNhdmVkRWxlbWVudHMiLCJ0b0FycmF5IiwiZWxlbWVudCIsInNrdSIsImdldEF0dHJpYnV0ZSIsImRlc2NyaXB0aW9uIiwiZmluZCIsImlubmVyVGV4dCIsImFkZEJ1dHRvbiIsImZpbHRlcmVkU2F2ZWRJdGVtcyIsImZpbHRlciIsInNhdmVkSXRlbSIsImluY2x1ZGVzIiwiYnV0dG9uQ29sb3IiLCJlbGVtZW50Q29sb3IiLCJzaW5jZUxhc3RDbGljayIsImNsaWNrIiwic2F2ZWRDYXJ0UnVudGltZSIsImRlZmF1bHRTZXR0aW5ncyIsImNoYW5nZWxvZ3MiLCJrZXkiLCJ0eXBlIiwiZXh0cmFUZXh0IiwicmV0cmlldmVTZXR0aW5ncyIsInN0b3JhZ2VHZXQiLCJjb25zdGFudHNfMSIsIm1zIiwic2V0VGltZW91dCIsImNvbG9ycyIsImNvbG9yIiwiciIsImciLCJiIiwic3RvcmFnZUtleSIsImRlZmF1bHRWYWx1ZSIsInN0b3JhZ2VSZXN1bHQiLCJnZXQiLCJzZXR0aW5nc0NhdGVnb3J5Iiwic2V0dGluZyIsInNldHRpbmdLZXkiLCJjb2xvclRleHQiLCJnZXRDb21wdXRlZFN0eWxlIiwiZ2V0UHJvcGVydHlWYWx1ZSIsInBhcnNlZENvbG9yIiwibWF0Y2hlZENvbG9yIiwibWF0Y2giLCJjbG9zZXN0IiwiZGlzdGFuY2UiLCJjaGVja0NvbG9yIiwiTWF0aCIsInNxcnQiLCJwb3ciLCJjYXRlZ29yeVNldHRpbmdzS1YiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCIsIm0iLCJPIiwiY2h1bmtJZHMiLCJmbiIsInByaW9yaXR5Iiwibm90RnVsZmlsbGVkIiwiSW5maW5pdHkiLCJpIiwiaiIsImtleXMiLCJldmVyeSIsInNwbGljZSIsIm4iLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJkZWZpbml0aW9uIiwibyIsImVudW1lcmFibGUiLCJnbG9iYWxUaGlzIiwiRnVuY3Rpb24iLCJ3aW5kb3ciLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsImluc3RhbGxlZENodW5rcyIsImNodW5rSWQiLCJ3ZWJwYWNrSnNvbnBDYWxsYmFjayIsInBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uIiwibW9yZU1vZHVsZXMiLCJjaHVua0xvYWRpbmdHbG9iYWwiLCJzZWxmIiwiZm9yRWFjaCIsImJpbmQiLCJwdXNoIiwiX193ZWJwYWNrX2V4cG9ydHNfXyJdLCJtYXBwaW5ncyI6InVCQUFJQSxFLHdCQ0NKLElBQUlDLEVBQWFDLE1BQVFBLEtBQUtELFdBQWMsU0FBVUUsRUFBU0MsRUFBWUMsRUFBR0MsR0FFMUUsT0FBTyxJQUFLRCxJQUFNQSxFQUFJRSxXQUFVLFNBQVVDLEVBQVNDLEdBQy9DLFNBQVNDLEVBQVVDLEdBQVMsSUFBTUMsRUFBS04sRUFBVU8sS0FBS0YsSUFBVyxNQUFPRyxHQUFLTCxFQUFPSyxJQUNwRixTQUFTQyxFQUFTSixHQUFTLElBQU1DLEVBQUtOLEVBQWlCLE1BQUVLLElBQVcsTUFBT0csR0FBS0wsRUFBT0ssSUFDdkYsU0FBU0YsRUFBS0ksR0FKbEIsSUFBZUwsRUFJYUssRUFBT0MsS0FBT1QsRUFBUVEsRUFBT0wsUUFKMUNBLEVBSXlESyxFQUFPTCxNQUpoREEsYUFBaUJOLEVBQUlNLEVBQVEsSUFBSU4sR0FBRSxTQUFVRyxHQUFXQSxFQUFRRyxPQUlUTyxLQUFLUixFQUFXSyxHQUNsR0gsR0FBTU4sRUFBWUEsRUFBVWEsTUFBTWhCLEVBQVNDLEdBQWMsS0FBS1MsWUFHdEVPLE9BQU9DLGVBQWVDLEVBQVMsYUFBYyxDQUFFWCxPQUFPLElBQ3RELE1BQU1ZLEVBQTZCLEVBQVEsTUFDckNDLEVBQWMsRUFBUSxNQUM1QixJQTZCSUMsRUE3QkFDLEVBQW1CLEdBQ25CQyxFQUF5QixDQUN6QixxQkFBd0IsV0FDcEIsT0FBTzFCLEVBQVVDLFVBQU0sT0FBUSxHQUFRLFlBQ25DdUIsRUFBb0IsSUFBSUcsTUFBTUYsRUFBdUMscUJBQUVmLFdBRy9FLGtCQUFxQixXQUNqQixPQUFPVixFQUFVQyxVQUFNLE9BQVEsR0FBUSxZQUNuQzJCLEVBQXNCSCxFQUFvQyxrQkFBRWYsTUFDdkRtQixNQUFNLEtBQUtDLEtBQUtDLEdBQVlBLEVBQVFDLE9BQU9DLHFC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SSxNQ0t4QixJQUFJcUIsRUFBa0IsQ0FDckIsSUFBSyxFQUNMLElBQUssRUFDTCxJQUFLLEdBYU5uQyxFQUFvQk8sRUFBRU8sRUFBS3NCLEdBQTBDLElBQTdCRCxFQUFnQkMsR0FHeEQsSUFBSUMsRUFBdUIsQ0FBQ0MsRUFBNEJwSCxLQUN2RCxJQUdJK0UsRUFBVW1DLEdBSFQ1QixFQUFVK0IsRUFBYS9ILEdBQVdVLEVBR2hCMkYsRUFBSSxFQUMzQixJQUFJWixLQUFZc0MsRUFDWnZDLEVBQW9Cd0IsRUFBRWUsRUFBYXRDLEtBQ3JDRCxFQUFvQk0sRUFBRUwsR0FBWXNDLEVBQVl0QyxJQUdoRCxHQUFHekYsRUFBUyxJQUFJaEMsRUFBU2dDLEVBQVF3RixHQUVqQyxJQURHc0MsR0FBNEJBLEVBQTJCcEgsR0FDckQyRixFQUFJTCxFQUFTMUUsT0FBUStFLElBQ3pCdUIsRUFBVTVCLEVBQVNLLEdBQ2hCYixFQUFvQndCLEVBQUVXLEVBQWlCQyxJQUFZRCxFQUFnQkMsSUFDckVELEVBQWdCQyxHQUFTLEtBRTFCRCxFQUFnQjNCLEVBQVNLLElBQU0sRUFFaEMsT0FBT2IsRUFBb0JPLEVBQUUvSCxJQUcxQmdLLEVBQXFCQyxLQUE0QixzQkFBSUEsS0FBNEIsdUJBQUssR0FDMUZELEVBQW1CRSxRQUFRTCxFQUFxQk0sS0FBSyxLQUFNLElBQzNESCxFQUFtQkksS0FBT1AsRUFBcUJNLEtBQUssS0FBTUgsRUFBbUJJLEtBQUtELEtBQUtILEssR0M3Q3ZGLElBQUlLLEVBQXNCN0MsRUFBb0JPLE9BQUV4RixFQUFXLENBQUMsTUFBTSxJQUFPaUYsRUFBb0IsUUFDN0Y2QyxFQUFzQjdDLEVBQW9CTyxFQUFFc0MsSSIsImZpbGUiOiJzb3VyY2UvYmVzdGJ1eV9jYXJ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGRlZmVycmVkID0gW107XG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8gPSAocmVzdWx0LCBjaHVua0lkcywgZm4sIHByaW9yaXR5KSA9PiB7XG5cdGlmKGNodW5rSWRzKSB7XG5cdFx0cHJpb3JpdHkgPSBwcmlvcml0eSB8fCAwO1xuXHRcdGZvcih2YXIgaSA9IGRlZmVycmVkLmxlbmd0aDsgaSA+IDAgJiYgZGVmZXJyZWRbaSAtIDFdWzJdID4gcHJpb3JpdHk7IGktLSkgZGVmZXJyZWRbaV0gPSBkZWZlcnJlZFtpIC0gMV07XG5cdFx0ZGVmZXJyZWRbaV0gPSBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV07XG5cdFx0cmV0dXJuO1xuXHR9XG5cdHZhciBub3RGdWxmaWxsZWQgPSBJbmZpbml0eTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkZWZlcnJlZC5sZW5ndGg7IGkrKykge1xuXHRcdHZhciBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV0gPSBkZWZlcnJlZFtpXTtcblx0XHR2YXIgZnVsZmlsbGVkID0gdHJ1ZTtcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGNodW5rSWRzLmxlbmd0aDsgaisrKSB7XG5cdFx0XHRpZiAoKHByaW9yaXR5ICYgMSA9PT0gMCB8fCBub3RGdWxmaWxsZWQgPj0gcHJpb3JpdHkpICYmIE9iamVjdC5rZXlzKF9fd2VicGFja19yZXF1aXJlX18uTykuZXZlcnkoKGtleSkgPT4gKF9fd2VicGFja19yZXF1aXJlX18uT1trZXldKGNodW5rSWRzW2pdKSkpKSB7XG5cdFx0XHRcdGNodW5rSWRzLnNwbGljZShqLS0sIDEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZnVsZmlsbGVkID0gZmFsc2U7XG5cdFx0XHRcdGlmKHByaW9yaXR5IDwgbm90RnVsZmlsbGVkKSBub3RGdWxmaWxsZWQgPSBwcmlvcml0eTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYoZnVsZmlsbGVkKSB7XG5cdFx0XHRkZWZlcnJlZC5zcGxpY2UoaS0tLCAxKVxuXHRcdFx0cmVzdWx0ID0gZm4oKTtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHJlc3VsdDtcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5jb25zdCB3ZWJleHRlbnNpb25fcG9seWZpbGxfdHNfMSA9IHJlcXVpcmUoXCJ3ZWJleHRlbnNpb24tcG9seWZpbGwtdHNcIik7XHJcbmNvbnN0IHV0aWxpdGllc18xID0gcmVxdWlyZShcIi4vdXRpbGl0aWVzXCIpO1xyXG5sZXQgY2F0ZWdvcnlTZXR0aW5ncyA9IHt9O1xyXG5sZXQgdXBkYXRlZFNldHRpbmdIYW5kbGVycyA9IHtcclxuICAgIFwibm90aWZpY2F0aW9uU291bmRVUkxcIjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvblNvdW5kID0gbmV3IEF1ZGlvKGNhdGVnb3J5U2V0dGluZ3NbXCJub3RpZmljYXRpb25Tb3VuZFVSTFwiXS52YWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgXCJ3aGl0ZWxpc3RLZXl3b3Jkc1wiOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgd2hpdGVsaXN0ZWRLZXl3b3JkcyA9IGNhdGVnb3J5U2V0dGluZ3NbXCJ3aGl0ZWxpc3RLZXl3b3Jkc1wiXS52YWx1ZVxyXG4gICAgICAgICAgICAgICAgLnNwbGl0KFwiLFwiKS5tYXAoKGtleXdvcmQpID0+IGtleXdvcmQudHJpbSgpLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59OyAvLyBIYW5kbGVycyBmb3Igd2hlbiBzZXR0aW5ncyBhcmUgdXBkYXRlZCB3aXRob3V0IHJlcXVpcmluZyByZWxvYWRcclxubGV0IG1lc3NhZ2VIYW5kbGVycyA9IHtcclxuICAgIFwidXBkYXRlZFNldHRpbmdcIjogZnVuY3Rpb24gKGZ1bGxTZXR0aW5nc0tleSwgdmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIGNhdGVnb3J5IGlzIGNvcnJlY3QsIHVwZGF0ZSBzZXR0aW5nIHRoZW4gY2FsbCBoYW5kbGVyXHJcbiAgICAgICAgICAgIGNvbnN0IFtjYXRlZ29yeSwgc2V0dGluZ3NLZXldID0gZnVsbFNldHRpbmdzS2V5LnNwbGl0KFwiLVwiKTtcclxuICAgICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSBcImJlc3RidXlcIikge1xyXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnlTZXR0aW5nc1tzZXR0aW5nc0tleV0udmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIHlpZWxkIHVwZGF0ZWRTZXR0aW5nSGFuZGxlcnNbc2V0dGluZ3NLZXldKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBcInRlc3ROb3RpZmljYXRpb25Tb3VuZFwiOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsgbm90aWZpY2F0aW9uU291bmQucGxheSgpOyB9KTtcclxuICAgIH1cclxufTtcclxubGV0IG5vdGlmaWNhdGlvblNvdW5kO1xyXG5sZXQgd2hpdGVsaXN0ZWRLZXl3b3JkcyA9IFtdOyAvLyBMb3dlcmNhc2VcclxubGV0IHNhdmVkSXRlbXMgPSBbXTtcclxubGV0IHByZXZpb3VzQ2FydExlbmd0aCA9IDA7IC8vIENhbm5vdCBhY2Nlc3MgRE9NIGdsb2JhbCB2YXJpYWJsZXMsIGltcHJvdmlzZVxyXG5sZXQgbGFzdENsaWNrZWRUaW1lID0gMDsgLy8gVW5peCB0aW1lc3RhbXAgZm9yIGxhc3QgdGltZSBidXR0b24gY2xpY2tlZFxyXG4vLyBDYXJ0IHBhZ2Ugc2F2ZWQgaXRlbXMgcnVudGltZSAtIHBlcmlvZGljYWxseSBwb2xscyBlbGVtZW50cyBmb3IgY29sb3IgYW5kIGNsaWNrYWJpbGl0eVxyXG5mdW5jdGlvbiBzYXZlZENhcnRSdW50aW1lKCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAvLyBHZXQgaW5pdGlhbCBwcmV2aW91cyBjYXJ0IGxlbmd0aCwgd2FpdCBmb3IgY2FydCB0byBsb2FkXHJcbiAgICAgICAgLy8gRml4ZXMgaXNzdWUgd2l0aCBmYWxzZSBcImFkZCB0byBjYXJ0XCIgbm90aWZpY2F0aW9uIGJlZm9yZSBwYWdlIGxvYWRzXHJcbiAgICAgICAgd2hpbGUgKCQoXCIucGFnZS1oZWFkaW5nX190aXRsZVwiKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgeWllbGQgdXRpbGl0aWVzXzEuc2xlZXAoY2F0ZWdvcnlTZXR0aW5nc1tcImdsb2JhbFBvbGxpbmdJbnRlcnZhbFwiXS52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGluaXRDYXJ0V3JhcHBlciA9ICQoXCIuaXRlbS1saXN0XCIpWzBdO1xyXG4gICAgICAgIHByZXZpb3VzQ2FydExlbmd0aCA9IGluaXRDYXJ0V3JhcHBlciAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgID8gaW5pdENhcnRXcmFwcGVyLmNoaWxkTm9kZXMubGVuZ3RoIDogMDtcclxuICAgICAgICAvLyBLZWVwIGxvb3AgcnVubmluZyB3aGlsZSBwYWdlIGlzIGxvYWRlZFxyXG4gICAgICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgICAgICAgIC8vIFdhaXQgdW50aWwgc3Bpbm5lciBub3Qgc2hvd2luZyB0byBjb250aW51ZSBpbnRlcnZhbFxyXG4gICAgICAgICAgICB3aGlsZSAoJChcIi5wYWdlLXNwaW5uZXItLWluXCIpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHlpZWxkIHV0aWxpdGllc18xLnNsZWVwKGNhdGVnb3J5U2V0dGluZ3NbXCJnbG9iYWxQb2xsaW5nSW50ZXJ2YWxcIl0udmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIENvbXBhcmUgY3VycmVudCBhbmQgcHJldmlvdXMgY2FydCBjb250ZW50cyBmb3IgY2hhbmdlc1xyXG4gICAgICAgICAgICAvLyBQbGF5IG5vdGlmaWNhdGlvbiBzb3VuZCBpZiBzb21ldGhpbmcgYWRkZWQgdG8gY2FydFxyXG4gICAgICAgICAgICBjb25zdCBjYXJ0V3JhcHBlciA9ICQoXCIuaXRlbS1saXN0XCIpWzBdO1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Q2FydExlbmd0aCA9IGNhcnRXcmFwcGVyICE9PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgID8gY2FydFdyYXBwZXIuY2hpbGROb2Rlcy5sZW5ndGggOiAwO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudENhcnRMZW5ndGggPiBwcmV2aW91c0NhcnRMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNvdW5kLnBsYXkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBJZ25vcmUgcGFyc2luZyBpZiBjYXJ0IGNvbnRhaW5zIGl0ZW0gYW5kIHNldHRpbmcgdG9nZ2xlZFxyXG4gICAgICAgICAgICBwcmV2aW91c0NhcnRMZW5ndGggPSBjdXJyZW50Q2FydExlbmd0aDtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRDYXJ0TGVuZ3RoID4gMCAmJiBjYXRlZ29yeVNldHRpbmdzW1wic3RvcENsaWNrQ2FydE9jY3VwaWVkXCJdLnZhbHVlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCB1dGlsaXRpZXNfMS5zbGVlcChjYXRlZ29yeVNldHRpbmdzW1wiZ2xvYmFsUG9sbGluZ0ludGVydmFsXCJdLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIENoZWNrIHdoZXRoZXIgc2F2ZWQgaXRlbSBidXR0b25zIHN0aWxsIGV4aXN0IGluIERPTVxyXG4gICAgICAgICAgICBjb25zdCBzdGlsbEV4aXN0cyA9IHNhdmVkSXRlbXMuc29tZShpdGVtRGF0YSA9PiAkLmNvbnRhaW5zKGRvY3VtZW50LmJvZHksIGl0ZW1EYXRhLndyYXBwZXIpKTtcclxuICAgICAgICAgICAgaWYgKHN0aWxsRXhpc3RzID09PSBmYWxzZSkgeyAvLyBTYXZlZCBpdGVtcyBwcm9iYWJseSByZWxvYWQsIHJlLXNjcmFwZVxyXG4gICAgICAgICAgICAgICAgbGV0IHNhdmVkRWxlbWVudHMgPSAkKFwiLnNhdmVkLWl0ZW1zX19jYXJkLXdyYXBwZXJcIikudG9BcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHNhdmVkRWxlbWVudHMubGVuZ3RoID09PSAwKSB7IC8vIFdhaXQgdW50aWwgc2F2ZWQgaXRlbXMgZWxlbWVudHMgZXhpc3RcclxuICAgICAgICAgICAgICAgICAgICB5aWVsZCB1dGlsaXRpZXNfMS5zbGVlcChjYXRlZ29yeVNldHRpbmdzW1wiZ2xvYmFsUG9sbGluZ0ludGVydmFsXCJdLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlZEVsZW1lbnRzID0gJChcIi5zYXZlZC1pdGVtc19fY2FyZC13cmFwcGVyXCIpLnRvQXJyYXkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIERpc2d1c3Rpbmcgd2F5IHRvIG1hcCBlbGVtZW50cywgY2FuJ3QgYXJyb3cgbWFwIHRvIGludGVyZmFjZSBhcHBhcmVudGx5XHJcbiAgICAgICAgICAgICAgICBzYXZlZEl0ZW1zID0gc2F2ZWRFbGVtZW50cy5tYXAoZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3cmFwcGVyOiBlbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBza3U6IGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS10ZXN0LXNhdmVkLXNrdVwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICQoZWxlbWVudCkuZmluZChcIi5zaW1wbGUtaXRlbV9fZGVzY3JpcHRpb25cIilbMF0uaW5uZXJUZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRCdXR0b246ICQoZWxlbWVudCkuZmluZChcIi5idG5cIilbMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5pdGlhbFNhdmVkTGVuZ3RoID0gc2F2ZWRJdGVtcy5sZW5ndGg7IC8vIEZvciBsb2dnaW5nIHB1cnBvc2VzIGV2ZW50dWFsbHlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBSZS1zY3JhcGUgc2F2ZWQgaXRlbXMgZWxlbWVudHMgb25seSB3aGVuIGRvZXNuJ3QgZXhpc3QsIGJ1dCByZS1maWx0ZXIgZXZlcnkgaW50ZXJ2YWxcclxuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRTYXZlZEl0ZW1zID0gc2F2ZWRJdGVtcy5maWx0ZXIoc2F2ZWRJdGVtID0+IHdoaXRlbGlzdGVkS2V5d29yZHMuc29tZShrZXl3b3JkID0+IGtleXdvcmQgIT09IFwiXCIgJiYgc2F2ZWRJdGVtLmRlc2NyaXB0aW9uLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoa2V5d29yZCkpKTtcclxuICAgICAgICAgICAgLy8gU2F2ZWQgaXRlbXMgc3RpbGwgbG9hZGVkIG9yIHJlLXNjcmFwZWQsIGl0ZXJhdGUgb3ZlclxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNhdmVkSXRlbSBvZiBmaWx0ZXJlZFNhdmVkSXRlbXMpIHtcclxuICAgICAgICAgICAgICAgIC8vIENoZWNrIHdoZXRoZXIgYnV0dG9uIGNvbG9yIGlzIGNsaWNrYWJsZSAobm90IGdyZXkpXHJcbiAgICAgICAgICAgICAgICBjb25zdCBidXR0b25Db2xvciA9IHV0aWxpdGllc18xLmVsZW1lbnRDb2xvcihzYXZlZEl0ZW0uYWRkQnV0dG9uKTtcclxuICAgICAgICAgICAgICAgIGlmIChbXCJ3aGl0ZVwiLCBcImJsdWVcIiwgXCJ5ZWxsb3dcIl0uaW5jbHVkZXMoYnV0dG9uQ29sb3IpID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2xpY2sgaWYgYXV0by1jbGljayBpcyBlbmFibGVkIGluIHNldHRpbmdzIGFuZCB0aW1lb3V0IGVsYXBzZWRcclxuICAgICAgICAgICAgICAgICAgICAvLyBHaXZpbmcgdGltZW91dCBiZXR3ZWVuIGJ1dHRvbiBjbGlja3MgcHJldmVudHMgcmF0ZS1saW1pdHMgYW5kIHN1Y2hcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzaW5jZUxhc3RDbGljayA9IE51bWJlcihuZXcgRGF0ZSgpKSAtIGxhc3RDbGlja2VkVGltZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2F0ZWdvcnlTZXR0aW5nc1tcImF1dG9DbGlja1doaXRlbGlzdGVkXCJdLnZhbHVlID09PSB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIHNpbmNlTGFzdENsaWNrID4gY2F0ZWdvcnlTZXR0aW5nc1tcInN1Y2Nlc3NpdmVDbGlja1RpbWVvdXRcIl0udmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWRJdGVtLmFkZEJ1dHRvbi5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0Q2xpY2tlZFRpbWUgPSBOdW1iZXIobmV3IERhdGUoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHlpZWxkIHV0aWxpdGllc18xLnNsZWVwKGNhdGVnb3J5U2V0dGluZ3NbXCJnbG9iYWxQb2xsaW5nSW50ZXJ2YWxcIl0udmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcbi8vIEFzeW5jaHJvbm91cyBtYWluIGNvbnRlbnQgc2NyaXB0IHJ1bnRpbWVcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgLy8gUmV0cmlldmUgdXBkYXRlZCBzZXR0aW5ncyBmcm9tIFN0b3JhZ2UgQVBJIGFuZCBpbml0aWFsaXplXHJcbiAgICAgICAgY2F0ZWdvcnlTZXR0aW5ncyA9IHlpZWxkIHV0aWxpdGllc18xLnJldHJpZXZlU2V0dGluZ3NLVihcImJlc3RidXlcIik7XHJcbiAgICAgICAgZm9yIChjb25zdCBbXywgdXBkYXRlZFNldHRpbmdIYW5kbGVyXSBvZiBPYmplY3QuZW50cmllcyh1cGRhdGVkU2V0dGluZ0hhbmRsZXJzKSkge1xyXG4gICAgICAgICAgICB5aWVsZCB1cGRhdGVkU2V0dGluZ0hhbmRsZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gU2V0dXAgbWVzc2FnZSBsaXN0ZW5lciBtYWlubHkgZm9yIHVwZGF0ZWQgc2V0dGluZ3NcclxuICAgICAgICB3ZWJleHRlbnNpb25fcG9seWZpbGxfdHNfMS5icm93c2VyLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKGZ1bmN0aW9uIChtZXNzYWdlLCBzZW5kZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgaGFuZGxlciB3aXRoIHByb3ZpZGVkIGFyZ3VtZW50cyBhbmQgcmVzcG9uZCBpZiBuZWNlc3NhcnlcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSBtZXNzYWdlSGFuZGxlcnNbbWVzc2FnZS5pbnN0cnVjdGlvbl07XHJcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlciAhPT0gdW5kZWZpbmVkKSB7IC8vIENoZWNrIHdoZXRoZXIgZ2l2ZW4gaGFuZGxlciBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB5aWVsZCBoYW5kbGVyKC4uLm1lc3NhZ2UuYXJndW1lbnRzIHx8IFtdKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OyAvLyBFcXVpdmFsZW50IHRvIHNlbmRSZXNwb25zZT9cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gU3RvcmUgY3VycmVudCBxdWV1ZSBkYXRhIGFsb25nIHdpdGggdGltZXN0YW1wXHJcbiAgICAgICAgY29uc3QgcXVldWVJbmZvID0ge1xyXG4gICAgICAgICAgICBkYXRhOiBhdG9iKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicHVyY2hhc2VUcmFja2VyXCIpIHx8IFwiZTMwPVwiKSxcclxuICAgICAgICAgICAgdGltZTogTnVtYmVyKG5ldyBEYXRlKCkpLFxyXG4gICAgICAgIH07IC8vIFwiTGFzdCB1cGRhdGVkXCIgdGltZXN0YW1wIGZvciBleHRlbnNpb25cclxuICAgICAgICB5aWVsZCB3ZWJleHRlbnNpb25fcG9seWZpbGxfdHNfMS5icm93c2VyLnN0b3JhZ2UubG9jYWwuc2V0KHsgXCJiZXN0YnV5LXF1ZXVlSW5mb1wiOiBxdWV1ZUluZm8gfSk7XHJcbiAgICAgICAgd2ViZXh0ZW5zaW9uX3BvbHlmaWxsX3RzXzEuYnJvd3Nlci5ydW50aW1lLnNlbmRNZXNzYWdlKHsgXCJpbnN0cnVjdGlvblwiOiBcInVwZGF0ZWRRdWV1ZUluZm9cIiwgXCJhcmd1bWVudHNcIjogW3F1ZXVlSW5mb10gfSk7XHJcbiAgICAgICAgeWllbGQgc2F2ZWRDYXJ0UnVudGltZSgpOyAvLyBBY3R1YWwgcnVudGltZSBmb3IgY2FydCBzdHVmZiwgcGVycGV0dWFsP1xyXG4gICAgfSk7XHJcbn0oKSk7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuZGVmYXVsdFNldHRpbmdzID0gZXhwb3J0cy5jaGFuZ2Vsb2dzID0gdm9pZCAwO1xyXG4vLyBDaGFuZ2Vsb2cgZnJvbSBwcmV2aW91cyB2ZXJzaW9uc1xyXG5leHBvcnRzLmNoYW5nZWxvZ3MgPSBbXHJcbiAgICB7XHJcbiAgICAgICAgXCJ2ZXJzaW9uXCI6IFwiYjAuMC4xXCIsXHJcbiAgICAgICAgXCJidWxsZXRwb2ludHNcIjogW1xyXG4gICAgICAgICAgICBgUG9ydGVkIG1vc3QgZnVuY3Rpb25hbGl0eSBmcm9tIFRhbXBlcm1vbmtleSBzY3JpcHQgbG9jYXRlZCA8YSBocmVmPVwiaHR0cHM6Ly9naXRodWIuY29tL2FsYmVydC1zdW4vdGFtcGVyLXNjcmlwdHMvXCI+aGVyZTwvYT5gLFxyXG4gICAgICAgICAgICBgPGI+Tm90IHlldCBpbXBsZW1lbnRlZDwvYj46IGJsYWNrbGlzdGVkIGtleXdvcmRzIGFuZCBidXR0b25zIGZvciB0ZXN0aW5nIHd0aWhpbiBzZXR0aW5ncyAocmVtb3ZlZCB1bnRpbCBzZXR0aW5ncyBzdHJ1Y3R1cmUgZmluYWxpemVkKWAsXHJcbiAgICAgICAgICAgIGA8Yj5JbXByb3ZlbWVudHMgZnJvbSBUYW1wZXJtb25rZXkgc2NyaXB0PC9iPjogSW5zdGFudCBzZXR0aW5ncyBwcm9wb2dhdGlvbiBhbmQgbm8gcmVmcmVzaCByZXF1aXJlZCBmb3IgY2FydCBhZGRpdGlvbiBvciByZW1vdmFsYFxyXG4gICAgICAgIF1cclxuICAgIH0sIHtcclxuICAgICAgICBcInZlcnNpb25cIjogXCJiMC4xLjBcIixcclxuICAgICAgICBcImJ1bGxldHBvaW50c1wiOiBbXHJcbiAgICAgICAgICAgIGBBZGRlZCBjaGFuZ2Vsb2cgKHRoaXMgdGFiIGhlcmUpIGFuZCBwbGFjZWhvbGRlciBsb2dnaW5nIHRhYiBmb3IgdGVzdGluZ2AsXHJcbiAgICAgICAgICAgIGBDaGFuZ2VkIGV4dGVuc2lvbiBzY3JpcHQgbG9hZGluZyB0byB3b3JrIHNvbWV3aGF0IG1vcmUgZHluYW1pY2FsbHlgLFxyXG4gICAgICAgIF1cclxuICAgIH1cclxuXTtcclxuLy8gU2V0dGluZ3MgYWNyb3NzIGFsbCBjYXRlZ29yaWVzIGZvciBleHRlbnNpb25cclxuZXhwb3J0cy5kZWZhdWx0U2V0dGluZ3MgPSB7XHJcbiAgICBcImJlc3RidXlcIjogW1xyXG4gICAgICAgIHsga2V5OiBcImF1dG9tYXRpY1F1ZXVlRml4XCIsIGRlc2NyaXB0aW9uOiBcIkF0dGVtcHQgdG8gYXV0b21hdGljYWxseSBmaXggYnJva2VuIHF1ZXVlc1wiLCB0eXBlOiBcInNsaWRlU3dpdGNoXCIsIHZhbHVlOiB0cnVlIH0sXHJcbiAgICAgICAgeyBrZXk6IFwiYXV0b0NsaWNrV2hpdGVsaXN0ZWRcIiwgZGVzY3JpcHRpb246IFwiQXV0b21hdGljYWxseSBjbGljayB3aGl0ZWxpc3RlZCBBVEMgYnV0dG9uc1wiLCB0eXBlOiBcInNsaWRlU3dpdGNoXCIsIHZhbHVlOiB0cnVlIH0sXHJcbiAgICAgICAgeyBrZXk6IFwic3RvcENsaWNrQ2FydE9jY3VwaWVkXCIsIGRlc2NyaXB0aW9uOiBcIlN0b3AgYXV0b21hdGljIGNsaWNraW5nIHdoZW4gY2FydCBvY2N1cGllZFwiLCB0eXBlOiBcInNsaWRlU3dpdGNoXCIsIHZhbHVlOiB0cnVlIH0sXHJcbiAgICAgICAgeyBrZXk6IFwiZ2xvYmFsUG9sbGluZ0ludGVydmFsXCIsIGRlc2NyaXB0aW9uOiBcIkdsb2JhbCBjb250ZW50IHNjcmlwdCBwb2xsaW5nIGludGVydmFsXCIsIHR5cGU6IFwibnVtYmVyXCIsIGV4dHJhVGV4dDogXCJtc1wiLCB2YWx1ZTogMTAwIH0sXHJcbiAgICAgICAgeyBrZXk6IFwic3VjY2Vzc2l2ZUNsaWNrVGltZW91dFwiLCBkZXNjcmlwdGlvbjogXCJUaW1lb3V0IGJldHdlZW4gY2xpY2tpbmcgdW5pcXVlIGJ1dHRvbnNcIiwgdHlwZTogXCJudW1iZXJcIiwgZXh0cmFUZXh0OiBcIm1zXCIsIHZhbHVlOiAyNTAwIH0sXHJcbiAgICAgICAgeyBrZXk6IFwibm90aWZpY2F0aW9uU291bmRVUkxcIiwgZGVzY3JpcHRpb246IFwiTm90aWZpY2F0aW9uIHNvdW5kIFVSTCAobXAzIGhvdGxpbmspXCIsIHR5cGU6IFwidGV4dFwiLCB2YWx1ZTogXCJodHRwczovL2dpdGh1Yi5jb20vYWxiZXJ0LXN1bi90YW1wZXItc2NyaXB0cy9ibG9iL21haW4vcmVzb3VyY2VzL25vdGlmaWNhdGlvbi5tcDM/cmF3PXRydWVcIiB9LFxyXG4gICAgICAgIHsga2V5OiBcIndoaXRlbGlzdEtleXdvcmRzXCIsIGRlc2NyaXB0aW9uOiBcIldoaXRlbGlzdGVkIGtleXdvcmRzIChjb21tYS1zZXBhcmF0ZWQpXCIsIHR5cGU6IFwidGV4dFwiLCB2YWx1ZTogXCIzMDYwLDMwNjB0aSwzMDYwIHRpLDMwNzAsMzA3MHRpLDMwNzAgdGksMzA4MCwzMDgwdGksMzA4MCB0aSwzMDkwXCIgfSxcclxuICAgICAgICAvLyB7IGtleTogXCJ0ZXN0Tm90aWZpY2F0aW9uU291bmRcIiwgZGVzY3JpcHRpb246IFwiUGxheSBjdXJyZW50IG5vdGlmaWNhdGlvbiBzb3VuZFwiLCB0eXBlOiBcImJ1dHRvblwiLCBpbnN0cnVjdGlvbjogXCJ0ZXN0Tm90aWZpY2F0aW9uU291bmRcIiB9LFxyXG4gICAgXVxyXG59O1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMucmV0cmlldmVTZXR0aW5nc0tWID0gZXhwb3J0cy5yZXRyaWV2ZVNldHRpbmdzID0gZXhwb3J0cy5zdG9yYWdlR2V0ID0gZXhwb3J0cy5lbGVtZW50Q29sb3IgPSBleHBvcnRzLnNsZWVwID0gdm9pZCAwO1xyXG5jb25zdCB3ZWJleHRlbnNpb25fcG9seWZpbGxfdHNfMSA9IHJlcXVpcmUoXCJ3ZWJleHRlbnNpb24tcG9seWZpbGwtdHNcIik7XHJcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzXCIpO1xyXG4vLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy85NTEwMjEvd2hhdC1pcy10aGUtamF2YXNjcmlwdC12ZXJzaW9uLW9mLXNsZWVwXHJcbi8vIFBvc3NpYmx5IGhhcyBpc3N1ZXMgcmVzb2x2aW5nIG9uIEZpcmVmb3g/IFN0YWNrT3ZlcmZsb3cgc3VyZSBkb2Vzbid0IHRoaW5rIHNvLi4uXHJcbmZ1bmN0aW9uIHNsZWVwKG1zKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XHJcbn1cclxuZXhwb3J0cy5zbGVlcCA9IHNsZWVwO1xyXG4vLyBBcHByb3hpbWF0ZXMgdGhlIHJlbmRlcmVkIGJhY2tncm91bmQgY29sb3Igb2YgYSBnaXZlbiBlbGVtZW50IHRvIGEgZ2l2ZW4gc2V0IG9mIGNvbG9ycy5cclxuLy8gQ2hlY2tzIHdoZXRoZXIgdGhlIFwiZGlzdGFuY2VcIiBmcm9tIHRoZSBlbGVtZW50IGNvbG9yIGlzIHRyYW5zcGFyZW50IG9yIGNsb3Nlc3QgdG8gZWl0aGVyIHllbGxvdy93aGl0ZS9ibHVlLlxyXG5jb25zdCBjb2xvcnMgPSBbXHJcbiAgICB7IGNvbG9yOiBcInllbGxvd1wiLCByOiAyNTUsIGc6IDIyNCwgYjogMCB9LFxyXG4gICAgeyBjb2xvcjogXCJibHVlXCIsIHI6IDAsIGc6IDMwLCBiOiAxMTUgfSxcclxuICAgIHsgY29sb3I6IFwiZ3JleVwiLCByOiAxOTcsIGc6IDIwMywgYjogMjEzIH0sXHJcbiAgICB7IGNvbG9yOiBcIndoaXRlXCIsIHI6IDI1NSwgZzogMjU1LCBiOiAyNTUgfSxcclxuXTtcclxuZnVuY3Rpb24gZWxlbWVudENvbG9yKGVsZW1lbnQpIHtcclxuICAgIC8vIEdldCB0aGUgcmVuZGVyZWQgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgZWxlbWVudFxyXG4gICAgY29uc3QgY29sb3JUZXh0ID0gZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKFwiYmFja2dyb3VuZC1jb2xvclwiKTtcclxuICAgIGlmIChjb2xvclRleHQuaW5jbHVkZXMoXCJyZ2IoMCwgMCwgMFwiKSkgeyAvLyBlbGVtZW50IGhhcyBubyBjb2xvciA9IHRyYW5zcGFyZW50XHJcbiAgICAgICAgcmV0dXJuIFwidHJhbnNwYXJlbnRcIjtcclxuICAgIH1cclxuICAgIC8vIFBhcnNlIFJHQiB2YWx1ZSBhbmQgdXNlIGZhbmN5IG1hdGhzIHRvIGZpbmQgY2xvc2VzdCBjb2xvclxyXG4gICAgY29uc3QgcGFyc2VkQ29sb3IgPSB7IHI6IDAsIGc6IDAsIGI6IDAgfTtcclxuICAgIGNvbnN0IG1hdGNoZWRDb2xvciA9IGNvbG9yVGV4dC5tYXRjaCgvXnJnYlxccypcXChcXHMqKFxcZCspXFxzKixcXHMqKFxcZCspXFxzKixcXHMqKFxcZCspXFxzKlxcKSQvaSk7XHJcbiAgICBwYXJzZWRDb2xvci5yID0gTnVtYmVyKG1hdGNoZWRDb2xvclsxXSk7XHJcbiAgICBwYXJzZWRDb2xvci5nID0gTnVtYmVyKG1hdGNoZWRDb2xvclsyXSk7XHJcbiAgICBwYXJzZWRDb2xvci5iID0gTnVtYmVyKG1hdGNoZWRDb2xvclszXSk7XHJcbiAgICBjb25zdCBjbG9zZXN0ID0geyBjb2xvcjogXCJcIiwgZGlzdGFuY2U6IDQ0MiB9OyAvLyBEZWZhdWx0IGRpc3RhbmNlIGp1c3Qgc2xpZ2h0bHkgbGFyZ2VyIHRoYW4gbWF4XHJcbiAgICBmb3IgKGNvbnN0IGNoZWNrQ29sb3Igb2YgY29sb3JzKSB7XHJcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLnNxcnQoTWF0aC5wb3coKHBhcnNlZENvbG9yLnIgLSBjaGVja0NvbG9yLnIpLCAyKSArIE1hdGgucG93KChwYXJzZWRDb2xvci5nIC0gY2hlY2tDb2xvci5nKSwgMikgKyAocGFyc2VkQ29sb3IuYiAtIGNoZWNrQ29sb3IuYikpO1xyXG4gICAgICAgIGlmIChkaXN0YW5jZSA8IGNsb3Nlc3QuZGlzdGFuY2UpIHtcclxuICAgICAgICAgICAgY2xvc2VzdC5jb2xvciA9IGNoZWNrQ29sb3IuY29sb3I7XHJcbiAgICAgICAgICAgIGNsb3Nlc3QuZGlzdGFuY2UgPSBkaXN0YW5jZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2xvc2VzdC5jb2xvcjtcclxufVxyXG5leHBvcnRzLmVsZW1lbnRDb2xvciA9IGVsZW1lbnRDb2xvcjtcclxuLy8gV3JhcHBlciBmb3IgcmV0cmlldmluZyBmcm9tIHN0b3JhZ2Ugd2l0aCBkZWZhdWx0IHZhbHVlIGlmIHVuZGVmaW5lZFxyXG5mdW5jdGlvbiBzdG9yYWdlR2V0KHN0b3JhZ2VLZXksIGRlZmF1bHRWYWx1ZSkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBzdG9yYWdlUmVzdWx0ID0geWllbGQgd2ViZXh0ZW5zaW9uX3BvbHlmaWxsX3RzXzEuYnJvd3Nlci5zdG9yYWdlLmxvY2FsLmdldChzdG9yYWdlS2V5KTtcclxuICAgICAgICByZXR1cm4gc3RvcmFnZVJlc3VsdFtzdG9yYWdlS2V5XSAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgID8gc3RvcmFnZVJlc3VsdFtzdG9yYWdlS2V5XSA6IGRlZmF1bHRWYWx1ZTtcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMuc3RvcmFnZUdldCA9IHN0b3JhZ2VHZXQ7XHJcbi8vIFdyYXBwZXIgZm9yIHJldHJpZXZpbmcgc2V0dGluZ3MgZm9yIGdpdmVuIGNhdGVnb3J5IGJ5IHVwZGF0aW5nIGZyb20gU3RvcmFnZSBBUElcclxuZnVuY3Rpb24gcmV0cmlldmVTZXR0aW5ncyhzZXR0aW5nc0NhdGVnb3J5KSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIC8vIEdldCBkZWZhdWx0IHNldHRpbmdzLCB0aGVuIHVwZGF0ZSBpbmRpdmlkdWFsIHNldHRpbmdzIGZyb20gU3RvcmFnZSBBUElcclxuICAgICAgICBjb25zdCBjYXRlZ29yeVNldHRpbmdzID0gY29uc3RhbnRzXzEuZGVmYXVsdFNldHRpbmdzW3NldHRpbmdzQ2F0ZWdvcnldO1xyXG4gICAgICAgIGZvciAoY29uc3Qgc2V0dGluZyBvZiBjYXRlZ29yeVNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIC8vIElnbm9yZSBzZXR0aW5ncyB3aXRob3V0IGEgdmFsdWUgKGJ1dHRvbnMgbWFpbmx5KVxyXG4gICAgICAgICAgICBpZiAoc2V0dGluZy52YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBSZXBsYWNlIHdpdGggdmFsdWUgZnJvbSBzdG9yYWdlIGlmIG1vZGlmaWVkIGV4aXN0cywgb3RoZXJ3aXNlIGtlZXAgZGVmYXVsdFxyXG4gICAgICAgICAgICBjb25zdCBzZXR0aW5nS2V5ID0gYHNldHRpbmctJHtzZXR0aW5nc0NhdGVnb3J5fS0ke3NldHRpbmcua2V5fWA7XHJcbiAgICAgICAgICAgIHNldHRpbmcudmFsdWUgPSB5aWVsZCBzdG9yYWdlR2V0KHNldHRpbmdLZXksIHNldHRpbmcudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2F0ZWdvcnlTZXR0aW5ncztcclxuICAgIH0pO1xyXG59XHJcbmV4cG9ydHMucmV0cmlldmVTZXR0aW5ncyA9IHJldHJpZXZlU2V0dGluZ3M7XHJcbi8vIFdyYXBwZXIgZm9yIGZvcm1hdHRpbmcgdGhlIHNldHRpbmdzIGludG8ga2V5LXZhbHVlIGluc3RlYWQgb2YgYXJyYXlcclxuZnVuY3Rpb24gcmV0cmlldmVTZXR0aW5nc0tWKHNldHRpbmdzQ2F0ZWdvcnkpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgY29uc3QgY2F0ZWdvcnlTZXR0aW5nc0tWID0ge307XHJcbiAgICAgICAgY29uc3QgY2F0ZWdvcnlTZXR0aW5ncyA9IHlpZWxkIHJldHJpZXZlU2V0dGluZ3Moc2V0dGluZ3NDYXRlZ29yeSk7IC8vIEdldCBzZXR0aW5ncyBiZWZvcmUgcmVmb3JtYXR0aW5nXHJcbiAgICAgICAgZm9yIChjb25zdCBzZXR0aW5nIG9mIGNhdGVnb3J5U2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgLy8gSWdub3JlIHNldHRpbmdzIHdpdGhvdXQgYSB2YWx1ZSAoYnV0dG9ucyBtYWlubHkpXHJcbiAgICAgICAgICAgIGlmIChzZXR0aW5nLnZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGVnb3J5U2V0dGluZ3NLVltzZXR0aW5nLmtleV0gPSBzZXR0aW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2F0ZWdvcnlTZXR0aW5nc0tWO1xyXG4gICAgfSk7XHJcbn1cclxuZXhwb3J0cy5yZXRyaWV2ZVNldHRpbmdzS1YgPSByZXRyaWV2ZVNldHRpbmdzS1Y7XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwiLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbl9fd2VicGFja19yZXF1aXJlX18ubiA9IChtb2R1bGUpID0+IHtcblx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG5cdFx0KCkgPT4gKG1vZHVsZVsnZGVmYXVsdCddKSA6XG5cdFx0KCkgPT4gKG1vZHVsZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsIHsgYTogZ2V0dGVyIH0pO1xuXHRyZXR1cm4gZ2V0dGVyO1xufTsiLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7XG5cdGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzO1xuXHR0cnkge1xuXHRcdHJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHR9IGNhdGNoIChlKSB7XG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSByZXR1cm4gd2luZG93O1xuXHR9XG59KSgpOyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmogPSA4NDM7IiwiLy8gbm8gYmFzZVVSSVxuXG4vLyBvYmplY3QgdG8gc3RvcmUgbG9hZGVkIGFuZCBsb2FkaW5nIGNodW5rc1xuLy8gdW5kZWZpbmVkID0gY2h1bmsgbm90IGxvYWRlZCwgbnVsbCA9IGNodW5rIHByZWxvYWRlZC9wcmVmZXRjaGVkXG4vLyBbcmVzb2x2ZSwgcmVqZWN0LCBQcm9taXNlXSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbnZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG5cdDg0MzogMCxcblx0NTMzOiAwLFxuXHQzODY6IDBcbn07XG5cbi8vIG5vIGNodW5rIG9uIGRlbWFuZCBsb2FkaW5nXG5cbi8vIG5vIHByZWZldGNoaW5nXG5cbi8vIG5vIHByZWxvYWRlZFxuXG4vLyBubyBITVJcblxuLy8gbm8gSE1SIG1hbmlmZXN0XG5cbl9fd2VicGFja19yZXF1aXJlX18uTy5qID0gKGNodW5rSWQpID0+IChpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPT09IDApO1xuXG4vLyBpbnN0YWxsIGEgSlNPTlAgY2FsbGJhY2sgZm9yIGNodW5rIGxvYWRpbmdcbnZhciB3ZWJwYWNrSnNvbnBDYWxsYmFjayA9IChwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiwgZGF0YSkgPT4ge1xuXHR2YXIgW2NodW5rSWRzLCBtb3JlTW9kdWxlcywgcnVudGltZV0gPSBkYXRhO1xuXHQvLyBhZGQgXCJtb3JlTW9kdWxlc1wiIHRvIHRoZSBtb2R1bGVzIG9iamVjdCxcblx0Ly8gdGhlbiBmbGFnIGFsbCBcImNodW5rSWRzXCIgYXMgbG9hZGVkIGFuZCBmaXJlIGNhbGxiYWNrXG5cdHZhciBtb2R1bGVJZCwgY2h1bmtJZCwgaSA9IDA7XG5cdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhtb3JlTW9kdWxlcywgbW9kdWxlSWQpKSB7XG5cdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLm1bbW9kdWxlSWRdID0gbW9yZU1vZHVsZXNbbW9kdWxlSWRdO1xuXHRcdH1cblx0fVxuXHRpZihydW50aW1lKSB2YXIgcmVzdWx0ID0gcnVudGltZShfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblx0aWYocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24pIHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKGRhdGEpO1xuXHRmb3IoO2kgPCBjaHVua0lkcy5sZW5ndGg7IGkrKykge1xuXHRcdGNodW5rSWQgPSBjaHVua0lkc1tpXTtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSAmJiBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0pIHtcblx0XHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXVswXSgpO1xuXHRcdH1cblx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZHNbaV1dID0gMDtcblx0fVxuXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHJlc3VsdCk7XG59XG5cbnZhciBjaHVua0xvYWRpbmdHbG9iYWwgPSBzZWxmW1wid2VicGFja0NodW5rZXh0ZW5zaW9uXCJdID0gc2VsZltcIndlYnBhY2tDaHVua2V4dGVuc2lvblwiXSB8fCBbXTtcbmNodW5rTG9hZGluZ0dsb2JhbC5mb3JFYWNoKHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgMCkpO1xuY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2ggPSB3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIGNodW5rTG9hZGluZ0dsb2JhbC5wdXNoLmJpbmQoY2h1bmtMb2FkaW5nR2xvYmFsKSk7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBkZXBlbmRzIG9uIG90aGVyIGxvYWRlZCBjaHVua3MgYW5kIGV4ZWN1dGlvbiBuZWVkIHRvIGJlIGRlbGF5ZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHVuZGVmaW5lZCwgWzczNl0sICgpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fKDk3MDUpKSlcbl9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8oX193ZWJwYWNrX2V4cG9ydHNfXyk7XG4iXSwic291cmNlUm9vdCI6IiJ9