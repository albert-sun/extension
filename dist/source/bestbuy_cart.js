(()=>{"use strict";var e,t={9705:function(e,t,o){var i=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function l(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,l)}a((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=o(9416),r=o(1209);let s,l={},a={notificationSoundURL:function(){return i(this,void 0,void 0,(function*(){s=new Audio(l.notificationSoundURL.value)}))},whitelistedKeywords:function(){return i(this,void 0,void 0,(function*(){c=l.whitelistedKeywords.value.split(",").map((e=>e.trim().toLowerCase()))}))},blacklistedKeywords:function(){return i(this,void 0,void 0,(function*(){d=l.blacklistedKeywords.value.split(",").map((e=>e.trim().toLowerCase()))}))}},u={updatedSetting:function(e,t){return i(this,void 0,void 0,(function*(){const[o,i]=e.split("-");"bestbuy"===o&&(l[i].value=t,yield a[i]())}))},testNotificationSound:function(){return i(this,void 0,void 0,(function*(){s.play()}))}},c=[],d=[],p=[],f=0,v=0;!function(){i(this,void 0,void 0,(function*(){l=yield r.retrieveSettingsKV("bestbuy");for(const[e,t]of Object.entries(a))yield t();n.browser.runtime.onMessage.addListener((function(e,t){return i(this,void 0,void 0,(function*(){const t=u[e.instruction];if(void 0!==t)return yield t(...e.arguments||[])}))}));const e={data:atob(localStorage.getItem("purchaseTracker")||"e30="),time:Number(new Date)};yield n.browser.storage.local.set({"bestbuy-queueInfo":e}),n.browser.runtime.sendMessage({instruction:"updatedQueueInfo",arguments:[e]}),yield function(){return i(this,void 0,void 0,(function*(){for(;0===$(".page-heading__title").length;)yield r.sleep(l.globalPollingInterval.value);const e=$(".item-list")[0];for(f=void 0!==e?e.childNodes.length:0;;){for(;$(".page-spinner--in").length>0;)yield r.sleep(l.globalPollingInterval.value);const e=$(".item-list")[0],t=void 0!==e?e.childNodes.length:0;if(t>f&&s.play(),f=t,t>0&&!0===l.stopClickCartOccupied.value){yield r.sleep(l.globalPollingInterval.value);continue}if(!1===p.some((e=>$.contains(document.body,e.wrapper)))){let e=$(".saved-items__card-wrapper").toArray();for(;0===e.length;)yield r.sleep(l.globalPollingInterval.value),e=$(".saved-items__card-wrapper").toArray();p=e.map((function(e){return{wrapper:e,sku:e.getAttribute("data-test-saved-sku"),description:$(e).find(".simple-item__description")[0].innerText,addButton:$(e).find(".btn")[0]}})),p.length}const o=p.filter((e=>c.some((t=>""!==t&&e.description.toLowerCase().includes(t))))).filter((e=>!d.every((t=>e.description.toLowerCase().includes(t)))));for(const e of o){const t=r.elementColor(e.addButton);if(!0===["white","blue","yellow"].includes(t)){const t=Number(new Date)-v;!0===l.autoClickWhitelisted.value&&t>l.successiveClickTimeout.value&&(e.addButton.click(),v=Number(new Date))}}yield r.sleep(l.globalPollingInterval.value)}}))}()}))}()},8681:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultSettings=t.changelogs=void 0,t.changelogs=[{version:"b0.2.0",bulletpoints:["Added About tab showing some information and usage instructions","Changed extension icon to something somewhat more presentable","Removed placeholder logging tab pending further development","Added blacklisted keywords functionality to script (still no test buttons)","Other minor edits to extension popup styling, nothing too major"]},{version:"b0.1.0",bulletpoints:["Added changelog (this tab here) and placeholder logging tab for testing","Changed extension script loading to work somewhat more dynamically"]},{version:"b0.0.1",bulletpoints:['Ported most functionality from Tampermonkey script located <a href="https://github.com/albert-sun/tamper-scripts/">here</a>',"<b>Features not yet implemented</b>: blacklisted keywords and buttons for testing wtihin settings (removed until settings structure finalized)","<b>Improvements from Tampermonkey script</b>: Instant settings propogation and no refresh required for cart addition or removal"]}],t.defaultSettings={bestbuy:[{key:"automaticQueueFix",description:"Attempt to automatically fix broken queues",type:"slideSwitch",value:!0},{key:"autoClickWhitelisted",description:"Automatically click whitelisted ATC buttons",type:"slideSwitch",value:!0},{key:"stopClickCartOccupied",description:"Stop automatic clicking when cart occupied",type:"slideSwitch",value:!0},{key:"globalPollingInterval",description:"Global content script polling interval",type:"number",extraText:"ms",value:100},{key:"successiveClickTimeout",description:"Timeout between clicking unique buttons",type:"number",extraText:"ms",value:2500},{key:"notificationSoundURL",description:"Notification sound URL (mp3 hotlink)",type:"text",value:"https://github.com/albert-sun/tamper-scripts/blob/main/resources/notification.mp3?raw=true"},{key:"whitelistedKeywords",description:"Whitelisted keywords (comma-separated)",type:"text",value:"3060,3060ti,3060 ti,3070,3070ti,3070 ti,3080,3080ti,3080 ti,3090"},{key:"blacklistedKeywords",description:"Blacklisted keywords (comma-separated)",type:"text",value:""}]}},1209:function(e,t,o){var i=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function l(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,l)}a((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.retrieveSettingsKV=t.retrieveSettings=t.storageGet=t.elementColor=t.sleep=void 0;const n=o(9416),r=o(8681);t.sleep=function(e){return new Promise((t=>setTimeout(t,e)))};const s=[{color:"yellow",r:255,g:224,b:0},{color:"blue",r:0,g:30,b:115},{color:"grey",r:197,g:203,b:213},{color:"white",r:255,g:255,b:255}];function l(e,t){return i(this,void 0,void 0,(function*(){const o=yield n.browser.storage.local.get(e);return void 0!==o[e]?o[e]:t}))}function a(e){return i(this,void 0,void 0,(function*(){const t=r.defaultSettings[e];for(const o of t){if(void 0===o.value)continue;const t=`setting-${e}-${o.key}`;o.value=yield l(t,o.value)}return t}))}t.elementColor=function(e){const t=getComputedStyle(e,null).getPropertyValue("background-color");if(t.includes("rgb(0, 0, 0"))return"transparent";const o={r:0,g:0,b:0},i=t.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);o.r=Number(i[1]),o.g=Number(i[2]),o.b=Number(i[3]);const n={color:"",distance:442};for(const e of s){const t=Math.sqrt(Math.pow(o.r-e.r,2)+Math.pow(o.g-e.g,2)+(o.b-e.b));t<n.distance&&(n.color=e.color,n.distance=t)}return n.color},t.storageGet=l,t.retrieveSettings=a,t.retrieveSettingsKV=function(e){return i(this,void 0,void 0,(function*(){const t={},o=yield a(e);for(const e of o)void 0!==e.value&&(t[e.key]=e);return t}))}}},o={};function i(e){var n=o[e];if(void 0!==n)return n.exports;var r=o[e]={exports:{}};return t[e].call(r.exports,r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,o,n,r)=>{if(!o){var s=1/0;for(u=0;u<e.length;u++){for(var[o,n,r]=e[u],l=!0,a=0;a<o.length;a++)(!1&r||s>=r)&&Object.keys(i.O).every((e=>i.O[e](o[a])))?o.splice(a--,1):(l=!1,r<s&&(s=r));l&&(e.splice(u--,1),t=n())}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[o,n,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=843,(()=>{var e={843:0,533:0,386:0};i.O.j=t=>0===e[t];var t=(t,o)=>{var n,r,[s,l,a]=o,u=0;for(n in l)i.o(l,n)&&(i.m[n]=l[n]);if(a)var c=a(i);for(t&&t(o);u<s.length;u++)r=s[u],i.o(e,r)&&e[r]&&e[r][0](),e[s[u]]=0;return i.O(c)},o=self.webpackChunkextension=self.webpackChunkextension||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var n=i.O(void 0,[736],(()=>i(9705)));n=i.O(n)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leHRlbnNpb24vd2VicGFjay9ydW50aW1lL2NodW5rIGxvYWRlZCIsIndlYnBhY2s6Ly9leHRlbnNpb24vLi9zb3VyY2UvYmVzdGJ1eV9jYXJ0LnRzIiwid2VicGFjazovL2V4dGVuc2lvbi8uL3NvdXJjZS9jb25zdGFudHMudHMiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uLy4vc291cmNlL3V0aWxpdGllcy50cyIsIndlYnBhY2s6Ly9leHRlbnNpb24vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovL2V4dGVuc2lvbi93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9ydW50aW1lSWQiLCJ3ZWJwYWNrOi8vZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL2V4dGVuc2lvbi93ZWJwYWNrL3N0YXJ0dXAiXSwibmFtZXMiOlsiZGVmZXJyZWQiLCJfX2F3YWl0ZXIiLCJ0aGlzIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsIndlYmV4dGVuc2lvbl9wb2x5ZmlsbF90c18xIiwidXRpbGl0aWVzXzEiLCJub3RpZmljYXRpb25Tb3VuZCIsImNhdGVnb3J5U2V0dGluZ3MiLCJ1cGRhdGVkU2V0dGluZ0hhbmRsZXJzIiwiQXVkaW8iLCJ3aGl0ZWxpc3RlZEtleXdvcmRzIiwic3BsaXQiLCJtYXAiLCJrZXl3b3JkIiwidHJpbSIsInRvTG93ZXJDYXNlIiwiYmxhY2tsaXN0ZWRLZXl3b3JkcyIsIm1lc3NhZ2VIYW5kbGVycyIsImZ1bGxTZXR0aW5nc0tleSIsImNhdGVnb3J5Iiwic2V0dGluZ3NLZXkiLCJwbGF5Iiwic2F2ZWRJdGVtcyIsInByZXZpb3VzQ2FydExlbmd0aCIsImxhc3RDbGlja2VkVGltZSIsInJldHJpZXZlU2V0dGluZ3NLViIsIl8iLCJ1cGRhdGVkU2V0dGluZ0hhbmRsZXIiLCJlbnRyaWVzIiwiYnJvd3NlciIsInJ1bnRpbWUiLCJvbk1lc3NhZ2UiLCJhZGRMaXN0ZW5lciIsIm1lc3NhZ2UiLCJzZW5kZXIiLCJoYW5kbGVyIiwiaW5zdHJ1Y3Rpb24iLCJ1bmRlZmluZWQiLCJhcmd1bWVudHMiLCJxdWV1ZUluZm8iLCJkYXRhIiwiYXRvYiIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJ0aW1lIiwiTnVtYmVyIiwiRGF0ZSIsInN0b3JhZ2UiLCJsb2NhbCIsInNldCIsInNlbmRNZXNzYWdlIiwiJCIsImxlbmd0aCIsInNsZWVwIiwiaW5pdENhcnRXcmFwcGVyIiwiY2hpbGROb2RlcyIsImNhcnRXcmFwcGVyIiwiY3VycmVudENhcnRMZW5ndGgiLCJzb21lIiwiaXRlbURhdGEiLCJjb250YWlucyIsImRvY3VtZW50IiwiYm9keSIsIndyYXBwZXIiLCJzYXZlZEVsZW1lbnRzIiwidG9BcnJheSIsImVsZW1lbnQiLCJza3UiLCJnZXRBdHRyaWJ1dGUiLCJkZXNjcmlwdGlvbiIsImZpbmQiLCJpbm5lclRleHQiLCJhZGRCdXR0b24iLCJmaWx0ZXJlZFNhdmVkSXRlbXMiLCJmaWx0ZXIiLCJzYXZlZEl0ZW0iLCJpbmNsdWRlcyIsImV2ZXJ5IiwiYnV0dG9uQ29sb3IiLCJlbGVtZW50Q29sb3IiLCJzaW5jZUxhc3RDbGljayIsImNsaWNrIiwic2F2ZWRDYXJ0UnVudGltZSIsImRlZmF1bHRTZXR0aW5ncyIsImNoYW5nZWxvZ3MiLCJrZXkiLCJ0eXBlIiwiZXh0cmFUZXh0IiwicmV0cmlldmVTZXR0aW5ncyIsInN0b3JhZ2VHZXQiLCJjb25zdGFudHNfMSIsIm1zIiwic2V0VGltZW91dCIsImNvbG9ycyIsImNvbG9yIiwiciIsImciLCJiIiwic3RvcmFnZUtleSIsImRlZmF1bHRWYWx1ZSIsInN0b3JhZ2VSZXN1bHQiLCJnZXQiLCJzZXR0aW5nc0NhdGVnb3J5Iiwic2V0dGluZyIsInNldHRpbmdLZXkiLCJjb2xvclRleHQiLCJnZXRDb21wdXRlZFN0eWxlIiwiZ2V0UHJvcGVydHlWYWx1ZSIsInBhcnNlZENvbG9yIiwibWF0Y2hlZENvbG9yIiwibWF0Y2giLCJjbG9zZXN0IiwiZGlzdGFuY2UiLCJjaGVja0NvbG9yIiwiTWF0aCIsInNxcnQiLCJwb3ciLCJjYXRlZ29yeVNldHRpbmdzS1YiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCIsIm0iLCJPIiwiY2h1bmtJZHMiLCJmbiIsInByaW9yaXR5Iiwibm90RnVsZmlsbGVkIiwiSW5maW5pdHkiLCJpIiwiaiIsImtleXMiLCJzcGxpY2UiLCJuIiwiZ2V0dGVyIiwiX19lc01vZHVsZSIsImQiLCJhIiwiZGVmaW5pdGlvbiIsIm8iLCJlbnVtZXJhYmxlIiwiZ2xvYmFsVGhpcyIsIkZ1bmN0aW9uIiwid2luZG93Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJpbnN0YWxsZWRDaHVua3MiLCJjaHVua0lkIiwid2VicGFja0pzb25wQ2FsbGJhY2siLCJwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiIsIm1vcmVNb2R1bGVzIiwiY2h1bmtMb2FkaW5nR2xvYmFsIiwic2VsZiIsImZvckVhY2giLCJiaW5kIiwicHVzaCIsIl9fd2VicGFja19leHBvcnRzX18iXSwibWFwcGluZ3MiOiJ1QkFBSUEsRSx3QkNDSixJQUFJQyxFQUFhQyxNQUFRQSxLQUFLRCxXQUFjLFNBQVVFLEVBQVNDLEVBQVlDLEVBQUdDLEdBRTFFLE9BQU8sSUFBS0QsSUFBTUEsRUFBSUUsV0FBVSxTQUFVQyxFQUFTQyxHQUMvQyxTQUFTQyxFQUFVQyxHQUFTLElBQU1DLEVBQUtOLEVBQVVPLEtBQUtGLElBQVcsTUFBT0csR0FBS0wsRUFBT0ssSUFDcEYsU0FBU0MsRUFBU0osR0FBUyxJQUFNQyxFQUFLTixFQUFpQixNQUFFSyxJQUFXLE1BQU9HLEdBQUtMLEVBQU9LLElBQ3ZGLFNBQVNGLEVBQUtJLEdBSmxCLElBQWVMLEVBSWFLLEVBQU9DLEtBQU9ULEVBQVFRLEVBQU9MLFFBSjFDQSxFQUl5REssRUFBT0wsTUFKaERBLGFBQWlCTixFQUFJTSxFQUFRLElBQUlOLEdBQUUsU0FBVUcsR0FBV0EsRUFBUUcsT0FJVE8sS0FBS1IsRUFBV0ssR0FDbEdILEdBQU1OLEVBQVlBLEVBQVVhLE1BQU1oQixFQUFTQyxHQUFjLEtBQUtTLFlBR3RFTyxPQUFPQyxlQUFlQyxFQUFTLGFBQWMsQ0FBRVgsT0FBTyxJQUN0RCxNQUFNWSxFQUE2QixFQUFRLE1BQ3JDQyxFQUFjLEVBQVEsTUFDNUIsSUFtQ0lDLEVBbkNBQyxFQUFtQixHQUNuQkMsRUFBeUIsQ0FDekIscUJBQXdCLFdBQ3BCLE9BQU8xQixFQUFVQyxVQUFNLE9BQVEsR0FBUSxZQUNuQ3VCLEVBQW9CLElBQUlHLE1BQU1GLEVBQXVDLHFCQUFFZixXQUcvRSxvQkFBdUIsV0FDbkIsT0FBT1YsRUFBVUMsVUFBTSxPQUFRLEdBQVEsWUFDbkMyQixFQUFzQkgsRUFBc0Msb0JBQUVmLE1BQ3pEbUIsTUFBTSxLQUFLQyxLQUFL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QVFMLEVBQXFCTSxLQUFLLEtBQU0sSUFDM0RILEVBQW1CSSxLQUFPUCxFQUFxQk0sS0FBSyxLQUFNSCxFQUFtQkksS0FBS0QsS0FBS0gsSyxHQzdDdkYsSUFBSUssRUFBc0I1QyxFQUFvQk8sT0FBRXpGLEVBQVcsQ0FBQyxNQUFNLElBQU9rRixFQUFvQixRQUM3RjRDLEVBQXNCNUMsRUFBb0JPLEVBQUVxQyxJIiwiZmlsZSI6InNvdXJjZS9iZXN0YnV5X2NhcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZGVmZXJyZWQgPSBbXTtcbl9fd2VicGFja19yZXF1aXJlX18uTyA9IChyZXN1bHQsIGNodW5rSWRzLCBmbiwgcHJpb3JpdHkpID0+IHtcblx0aWYoY2h1bmtJZHMpIHtcblx0XHRwcmlvcml0eSA9IHByaW9yaXR5IHx8IDA7XG5cdFx0Zm9yKHZhciBpID0gZGVmZXJyZWQubGVuZ3RoOyBpID4gMCAmJiBkZWZlcnJlZFtpIC0gMV1bMl0gPiBwcmlvcml0eTsgaS0tKSBkZWZlcnJlZFtpXSA9IGRlZmVycmVkW2kgLSAxXTtcblx0XHRkZWZlcnJlZFtpXSA9IFtjaHVua0lkcywgZm4sIHByaW9yaXR5XTtcblx0XHRyZXR1cm47XG5cdH1cblx0dmFyIG5vdEZ1bGZpbGxlZCA9IEluZmluaXR5O1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGRlZmVycmVkLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIFtjaHVua0lkcywgZm4sIHByaW9yaXR5XSA9IGRlZmVycmVkW2ldO1xuXHRcdHZhciBmdWxmaWxsZWQgPSB0cnVlO1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2h1bmtJZHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdGlmICgocHJpb3JpdHkgJiAxID09PSAwIHx8IG5vdEZ1bGZpbGxlZCA+PSBwcmlvcml0eSkgJiYgT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5PKS5ldmVyeSgoa2V5KSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXy5PW2tleV0oY2h1bmtJZHNbal0pKSkpIHtcblx0XHRcdFx0Y2h1bmtJZHMuc3BsaWNlKGotLSwgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmdWxmaWxsZWQgPSBmYWxzZTtcblx0XHRcdFx0aWYocHJpb3JpdHkgPCBub3RGdWxmaWxsZWQpIG5vdEZ1bGZpbGxlZCA9IHByaW9yaXR5O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihmdWxmaWxsZWQpIHtcblx0XHRcdGRlZmVycmVkLnNwbGljZShpLS0sIDEpXG5cdFx0XHRyZXN1bHQgPSBmbigpO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTsiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IHdlYmV4dGVuc2lvbl9wb2x5ZmlsbF90c18xID0gcmVxdWlyZShcIndlYmV4dGVuc2lvbi1wb2x5ZmlsbC10c1wiKTtcclxuY29uc3QgdXRpbGl0aWVzXzEgPSByZXF1aXJlKFwiLi91dGlsaXRpZXNcIik7XHJcbmxldCBjYXRlZ29yeVNldHRpbmdzID0ge307XHJcbmxldCB1cGRhdGVkU2V0dGluZ0hhbmRsZXJzID0ge1xyXG4gICAgXCJub3RpZmljYXRpb25Tb3VuZFVSTFwiOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgbm90aWZpY2F0aW9uU291bmQgPSBuZXcgQXVkaW8oY2F0ZWdvcnlTZXR0aW5nc1tcIm5vdGlmaWNhdGlvblNvdW5kVVJMXCJdLnZhbHVlKTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBcIndoaXRlbGlzdGVkS2V5d29yZHNcIjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIHdoaXRlbGlzdGVkS2V5d29yZHMgPSBjYXRlZ29yeVNldHRpbmdzW1wid2hpdGVsaXN0ZWRLZXl3b3Jkc1wiXS52YWx1ZVxyXG4gICAgICAgICAgICAgICAgLnNwbGl0KFwiLFwiKS5tYXAoKGtleXdvcmQpID0+IGtleXdvcmQudHJpbSgpLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIFwiYmxhY2tsaXN0ZWRLZXl3b3Jkc1wiOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgYmxhY2tsaXN0ZWRLZXl3b3JkcyA9IGNhdGVnb3J5U2V0dGluZ3NbXCJibGFja2xpc3RlZEtleXdvcmRzXCJdLnZhbHVlXHJcbiAgICAgICAgICAgICAgICAuc3BsaXQoXCIsXCIpLm1hcCgoa2V5d29yZCkgPT4ga2V5d29yZC50cmltKCkudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07IC8vIEhhbmRsZXJzIGZvciB3aGVuIHNldHRpbmdzIGFyZSB1cGRhdGVkIHdpdGhvdXQgcmVxdWlyaW5nIHJlbG9hZFxyXG5sZXQgbWVzc2FnZUhhbmRsZXJzID0ge1xyXG4gICAgXCJ1cGRhdGVkU2V0dGluZ1wiOiBmdW5jdGlvbiAoZnVsbFNldHRpbmdzS2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgY2F0ZWdvcnkgaXMgY29ycmVjdCwgdXBkYXRlIHNldHRpbmcgdGhlbiBjYWxsIGhhbmRsZXJcclxuICAgICAgICAgICAgY29uc3QgW2NhdGVnb3J5LCBzZXR0aW5nc0tleV0gPSBmdWxsU2V0dGluZ3NLZXkuc3BsaXQoXCItXCIpO1xyXG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09IFwiYmVzdGJ1eVwiKSB7XHJcbiAgICAgICAgICAgICAgICBjYXRlZ29yeVNldHRpbmdzW3NldHRpbmdzS2V5XS52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgeWllbGQgdXBkYXRlZFNldHRpbmdIYW5kbGVyc1tzZXR0aW5nc0tleV0oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIFwidGVzdE5vdGlmaWNhdGlvblNvdW5kXCI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgeyBub3RpZmljYXRpb25Tb3VuZC5wbGF5KCk7IH0pO1xyXG4gICAgfVxyXG59O1xyXG5sZXQgbm90aWZpY2F0aW9uU291bmQ7XHJcbmxldCB3aGl0ZWxpc3RlZEtleXdvcmRzID0gW107IC8vIExvd2VyY2FzZVxyXG5sZXQgYmxhY2tsaXN0ZWRLZXl3b3JkcyA9IFtdOyAvLyBMb3dlcmNhc2VcclxubGV0IHNhdmVkSXRlbXMgPSBbXTtcclxubGV0IHByZXZpb3VzQ2FydExlbmd0aCA9IDA7IC8vIENhbm5vdCBhY2Nlc3MgRE9NIGdsb2JhbCB2YXJpYWJsZXMsIGltcHJvdmlzZVxyXG5sZXQgbGFzdENsaWNrZWRUaW1lID0gMDsgLy8gVW5peCB0aW1lc3RhbXAgZm9yIGxhc3QgdGltZSBidXR0b24gY2xpY2tlZFxyXG4vLyBDYXJ0IHBhZ2Ugc2F2ZWQgaXRlbXMgcnVudGltZSAtIHBlcmlvZGljYWxseSBwb2xscyBlbGVtZW50cyBmb3IgY29sb3IgYW5kIGNsaWNrYWJpbGl0eVxyXG5mdW5jdGlvbiBzYXZlZENhcnRSdW50aW1lKCkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAvLyBHZXQgaW5pdGlhbCBwcmV2aW91cyBjYXJ0IGxlbmd0aCwgd2FpdCBmb3IgY2FydCB0byBsb2FkXHJcbiAgICAgICAgLy8gRml4ZXMgaXNzdWUgd2l0aCBmYWxzZSBcImFkZCB0byBjYXJ0XCIgbm90aWZpY2F0aW9uIGJlZm9yZSBwYWdlIGxvYWRzXHJcbiAgICAgICAgd2hpbGUgKCQoXCIucGFnZS1oZWFkaW5nX190aXRsZVwiKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgeWllbGQgdXRpbGl0aWVzXzEuc2xlZXAoY2F0ZWdvcnlTZXR0aW5nc1tcImdsb2JhbFBvbGxpbmdJbnRlcnZhbFwiXS52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGluaXRDYXJ0V3JhcHBlciA9ICQoXCIuaXRlbS1saXN0XCIpWzBdO1xyXG4gICAgICAgIHByZXZpb3VzQ2FydExlbmd0aCA9IGluaXRDYXJ0V3JhcHBlciAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgID8gaW5pdENhcnRXcmFwcGVyLmNoaWxkTm9kZXMubGVuZ3RoIDogMDtcclxuICAgICAgICAvLyBLZWVwIGxvb3AgcnVubmluZyB3aGlsZSBwYWdlIGlzIGxvYWRlZFxyXG4gICAgICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgICAgICAgIC8vIFdhaXQgdW50aWwgc3Bpbm5lciBub3Qgc2hvd2luZyB0byBjb250aW51ZSBpbnRlcnZhbFxyXG4gICAgICAgICAgICB3aGlsZSAoJChcIi5wYWdlLXNwaW5uZXItLWluXCIpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHlpZWxkIHV0aWxpdGllc18xLnNsZWVwKGNhdGVnb3J5U2V0dGluZ3NbXCJnbG9iYWxQb2xsaW5nSW50ZXJ2YWxcIl0udmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIENvbXBhcmUgY3VycmVudCBhbmQgcHJldmlvdXMgY2FydCBjb250ZW50cyBmb3IgY2hhbmdlc1xyXG4gICAgICAgICAgICAvLyBQbGF5IG5vdGlmaWNhdGlvbiBzb3VuZCBpZiBzb21ldGhpbmcgYWRkZWQgdG8gY2FydFxyXG4gICAgICAgICAgICBjb25zdCBjYXJ0V3JhcHBlciA9ICQoXCIuaXRlbS1saXN0XCIpWzBdO1xyXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Q2FydExlbmd0aCA9IGNhcnRXcmFwcGVyICE9PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgID8gY2FydFdyYXBwZXIuY2hpbGROb2Rlcy5sZW5ndGggOiAwO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudENhcnRMZW5ndGggPiBwcmV2aW91c0NhcnRMZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNvdW5kLnBsYXkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBJZ25vcmUgcGFyc2luZyBpZiBjYXJ0IGNvbnRhaW5zIGl0ZW0gYW5kIHNldHRpbmcgdG9nZ2xlZFxyXG4gICAgICAgICAgICBwcmV2aW91c0NhcnRMZW5ndGggPSBjdXJyZW50Q2FydExlbmd0aDtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRDYXJ0TGVuZ3RoID4gMCAmJiBjYXRlZ29yeVNldHRpbmdzW1wic3RvcENsaWNrQ2FydE9jY3VwaWVkXCJdLnZhbHVlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCB1dGlsaXRpZXNfMS5zbGVlcChjYXRlZ29yeVNldHRpbmdzW1wiZ2xvYmFsUG9sbGluZ0ludGVydmFsXCJdLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIENoZWNrIHdoZXRoZXIgc2F2ZWQgaXRlbSBidXR0b25zIHN0aWxsIGV4aXN0IGluIERPTVxyXG4gICAgICAgICAgICBjb25zdCBzdGlsbEV4aXN0cyA9IHNhdmVkSXRlbXMuc29tZShpdGVtRGF0YSA9PiAkLmNvbnRhaW5zKGRvY3VtZW50LmJvZHksIGl0ZW1EYXRhLndyYXBwZXIpKTtcclxuICAgICAgICAgICAgaWYgKHN0aWxsRXhpc3RzID09PSBmYWxzZSkgeyAvLyBTYXZlZCBpdGVtcyBwcm9iYWJseSByZWxvYWQsIHJlLXNjcmFwZVxyXG4gICAgICAgICAgICAgICAgbGV0IHNhdmVkRWxlbWVudHMgPSAkKFwiLnNhdmVkLWl0ZW1zX19jYXJkLXdyYXBwZXJcIikudG9BcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHNhdmVkRWxlbWVudHMubGVuZ3RoID09PSAwKSB7IC8vIFdhaXQgdW50aWwgc2F2ZWQgaXRlbXMgZWxlbWVudHMgZXhpc3RcclxuICAgICAgICAgICAgICAgICAgICB5aWVsZCB1dGlsaXRpZXNfMS5zbGVlcChjYXRlZ29yeVNldHRpbmdzW1wiZ2xvYmFsUG9sbGluZ0ludGVydmFsXCJdLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlZEVsZW1lbnRzID0gJChcIi5zYXZlZC1pdGVtc19fY2FyZC13cmFwcGVyXCIpLnRvQXJyYXkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIERpc2d1c3Rpbmcgd2F5IHRvIG1hcCBlbGVtZW50cywgY2FuJ3QgYXJyb3cgbWFwIHRvIGludGVyZmFjZSBhcHBhcmVudGx5XHJcbiAgICAgICAgICAgICAgICBzYXZlZEl0ZW1zID0gc2F2ZWRFbGVtZW50cy5tYXAoZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3cmFwcGVyOiBlbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBza3U6IGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS10ZXN0LXNhdmVkLXNrdVwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICQoZWxlbWVudCkuZmluZChcIi5zaW1wbGUtaXRlbV9fZGVzY3JpcHRpb25cIilbMF0uaW5uZXJUZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRCdXR0b246ICQoZWxlbWVudCkuZmluZChcIi5idG5cIilbMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5pdGlhbFNhdmVkTGVuZ3RoID0gc2F2ZWRJdGVtcy5sZW5ndGg7IC8vIEZvciBsb2dnaW5nIHB1cnBvc2VzIGV2ZW50dWFsbHlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBSZS1zY3JhcGUgc2F2ZWQgaXRlbXMgZWxlbWVudHMgb25seSB3aGVuIHVubG9hZGVkIGZyb20gRE9NLCBidXQgcmUtZmlsdGVyIGV2ZXJ5IGludGVydmFsXHJcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkU2F2ZWRJdGVtcyA9IHNhdmVkSXRlbXMuZmlsdGVyKHNhdmVkSXRlbSA9PiB3aGl0ZWxpc3RlZEtleXdvcmRzLnNvbWUoLy8gQ29udGFpbnMgYXQgbGVhc3Qgb25lIHdoaXRlbGlzdGVkIGtleXdvcmRcclxuICAgICAgICAgICAgLy8gQ29udGFpbnMgYXQgbGVhc3Qgb25lIHdoaXRlbGlzdGVkIGtleXdvcmRcclxuICAgICAgICAgICAga2V5d29yZCA9PiBrZXl3b3JkICE9PSBcIlwiICYmIHNhdmVkSXRlbS5kZXNjcmlwdGlvbi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGtleXdvcmQpKSkuZmlsdGVyKC8vIENvbnRhaW5zIG5vIHdoaXRlbGlzdGVkIGtleXdvcmRzXHJcbiAgICAgICAgICAgIC8vIENvbnRhaW5zIG5vIHdoaXRlbGlzdGVkIGtleXdvcmRzXHJcbiAgICAgICAgICAgIHNhdmVkSXRlbSA9PiAhYmxhY2tsaXN0ZWRLZXl3b3Jkcy5ldmVyeShrZXl3b3JkID0+IHNhdmVkSXRlbS5kZXNjcmlwdGlvbi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGtleXdvcmQpKSk7XHJcbiAgICAgICAgICAgIC8vIFNhdmVkIGl0ZW1zIHN0aWxsIGxvYWRlZCBvciByZS1zY3JhcGVkLCBpdGVyYXRlIG92ZXJcclxuICAgICAgICAgICAgZm9yIChjb25zdCBzYXZlZEl0ZW0gb2YgZmlsdGVyZWRTYXZlZEl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBDaGVjayB3aGV0aGVyIGJ1dHRvbiBjb2xvciBpcyBjbGlja2FibGUgKG5vdCBncmV5KVxyXG4gICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uQ29sb3IgPSB1dGlsaXRpZXNfMS5lbGVtZW50Q29sb3Ioc2F2ZWRJdGVtLmFkZEJ1dHRvbik7XHJcbiAgICAgICAgICAgICAgICBpZiAoW1wid2hpdGVcIiwgXCJibHVlXCIsIFwieWVsbG93XCJdLmluY2x1ZGVzKGJ1dHRvbkNvbG9yKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENsaWNrIGlmIGF1dG8tY2xpY2sgaXMgZW5hYmxlZCBpbiBzZXR0aW5ncyBhbmQgdGltZW91dCBlbGFwc2VkXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gR2l2aW5nIHRpbWVvdXQgYmV0d2VlbiBidXR0b24gY2xpY2tzIHByZXZlbnRzIHJhdGUtbGltaXRzIGFuZCBzdWNoXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2luY2VMYXN0Q2xpY2sgPSBOdW1iZXIobmV3IERhdGUoKSkgLSBsYXN0Q2xpY2tlZFRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhdGVnb3J5U2V0dGluZ3NbXCJhdXRvQ2xpY2tXaGl0ZWxpc3RlZFwiXS52YWx1ZSA9PT0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBzaW5jZUxhc3RDbGljayA+IGNhdGVnb3J5U2V0dGluZ3NbXCJzdWNjZXNzaXZlQ2xpY2tUaW1lb3V0XCJdLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkSXRlbS5hZGRCdXR0b24uY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdENsaWNrZWRUaW1lID0gTnVtYmVyKG5ldyBEYXRlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB5aWVsZCB1dGlsaXRpZXNfMS5zbGVlcChjYXRlZ29yeVNldHRpbmdzW1wiZ2xvYmFsUG9sbGluZ0ludGVydmFsXCJdLnZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG4vLyBBc3luY2hyb25vdXMgbWFpbiBjb250ZW50IHNjcmlwdCBydW50aW1lXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIC8vIFJldHJpZXZlIHVwZGF0ZWQgc2V0dGluZ3MgZnJvbSBTdG9yYWdlIEFQSSBhbmQgaW5pdGlhbGl6ZVxyXG4gICAgICAgIGNhdGVnb3J5U2V0dGluZ3MgPSB5aWVsZCB1dGlsaXRpZXNfMS5yZXRyaWV2ZVNldHRpbmdzS1YoXCJiZXN0YnV5XCIpO1xyXG4gICAgICAgIGZvciAoY29uc3QgW18sIHVwZGF0ZWRTZXR0aW5nSGFuZGxlcl0gb2YgT2JqZWN0LmVudHJpZXModXBkYXRlZFNldHRpbmdIYW5kbGVycykpIHtcclxuICAgICAgICAgICAgeWllbGQgdXBkYXRlZFNldHRpbmdIYW5kbGVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFNldHVwIG1lc3NhZ2UgbGlzdGVuZXIgbWFpbmx5IGZvciB1cGRhdGVkIHNldHRpbmdzXHJcbiAgICAgICAgd2ViZXh0ZW5zaW9uX3BvbHlmaWxsX3RzXzEuYnJvd3Nlci5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihmdW5jdGlvbiAobWVzc2FnZSwgc2VuZGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGhhbmRsZXIgd2l0aCBwcm92aWRlZCBhcmd1bWVudHMgYW5kIHJlc3BvbmQgaWYgbmVjZXNzYXJ5XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gbWVzc2FnZUhhbmRsZXJzW21lc3NhZ2UuaW5zdHJ1Y3Rpb25dO1xyXG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIgIT09IHVuZGVmaW5lZCkgeyAvLyBDaGVjayB3aGV0aGVyIGdpdmVuIGhhbmRsZXIgZXhpc3RzXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0geWllbGQgaGFuZGxlciguLi5tZXNzYWdlLmFyZ3VtZW50cyB8fCBbXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsgLy8gRXF1aXZhbGVudCB0byBzZW5kUmVzcG9uc2U/XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIFN0b3JlIGN1cnJlbnQgcXVldWUgZGF0YSBhbG9uZyB3aXRoIHRpbWVzdGFtcFxyXG4gICAgICAgIGNvbnN0IHF1ZXVlSW5mbyA9IHtcclxuICAgICAgICAgICAgZGF0YTogYXRvYihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInB1cmNoYXNlVHJhY2tlclwiKSB8fCBcImUzMD1cIiksXHJcbiAgICAgICAgICAgIHRpbWU6IE51bWJlcihuZXcgRGF0ZSgpKSxcclxuICAgICAgICB9OyAvLyBcIkxhc3QgdXBkYXRlZFwiIHRpbWVzdGFtcCBmb3IgZXh0ZW5zaW9uXHJcbiAgICAgICAgeWllbGQgd2ViZXh0ZW5zaW9uX3BvbHlmaWxsX3RzXzEuYnJvd3Nlci5zdG9yYWdlLmxvY2FsLnNldCh7IFwiYmVzdGJ1eS1xdWV1ZUluZm9cIjogcXVldWVJbmZvIH0pO1xyXG4gICAgICAgIHdlYmV4dGVuc2lvbl9wb2x5ZmlsbF90c18xLmJyb3dzZXIucnVudGltZS5zZW5kTWVzc2FnZSh7IFwiaW5zdHJ1Y3Rpb25cIjogXCJ1cGRhdGVkUXVldWVJbmZvXCIsIFwiYXJndW1lbnRzXCI6IFtxdWV1ZUluZm9dIH0pO1xyXG4gICAgICAgIHlpZWxkIHNhdmVkQ2FydFJ1bnRpbWUoKTsgLy8gQWN0dWFsIHJ1bnRpbWUgZm9yIGNhcnQgc3R1ZmYsIHBlcnBldHVhbD9cclxuICAgIH0pO1xyXG59KCkpO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLmRlZmF1bHRTZXR0aW5ncyA9IGV4cG9ydHMuY2hhbmdlbG9ncyA9IHZvaWQgMDtcclxuLy8gQ2hhbmdlbG9nIGZyb20gcHJldmlvdXMgdmVyc2lvbnNcclxuZXhwb3J0cy5jaGFuZ2Vsb2dzID0gW1xyXG4gICAge1xyXG4gICAgICAgIFwidmVyc2lvblwiOiBcImIwLjIuMFwiLFxyXG4gICAgICAgIFwiYnVsbGV0cG9pbnRzXCI6IFtcclxuICAgICAgICAgICAgYEFkZGVkIEFib3V0IHRhYiBzaG93aW5nIHNvbWUgaW5mb3JtYXRpb24gYW5kIHVzYWdlIGluc3RydWN0aW9uc2AsXHJcbiAgICAgICAgICAgIGBDaGFuZ2VkIGV4dGVuc2lvbiBpY29uIHRvIHNvbWV0aGluZyBzb21ld2hhdCBtb3JlIHByZXNlbnRhYmxlYCxcclxuICAgICAgICAgICAgYFJlbW92ZWQgcGxhY2Vob2xkZXIgbG9nZ2luZyB0YWIgcGVuZGluZyBmdXJ0aGVyIGRldmVsb3BtZW50YCxcclxuICAgICAgICAgICAgYEFkZGVkIGJsYWNrbGlzdGVkIGtleXdvcmRzIGZ1bmN0aW9uYWxpdHkgdG8gc2NyaXB0IChzdGlsbCBubyB0ZXN0IGJ1dHRvbnMpYCxcclxuICAgICAgICAgICAgYE90aGVyIG1pbm9yIGVkaXRzIHRvIGV4dGVuc2lvbiBwb3B1cCBzdHlsaW5nLCBub3RoaW5nIHRvbyBtYWpvcmAsXHJcbiAgICAgICAgXVxyXG4gICAgfSwge1xyXG4gICAgICAgIFwidmVyc2lvblwiOiBcImIwLjEuMFwiLFxyXG4gICAgICAgIFwiYnVsbGV0cG9pbnRzXCI6IFtcclxuICAgICAgICAgICAgYEFkZGVkIGNoYW5nZWxvZyAodGhpcyB0YWIgaGVyZSkgYW5kIHBsYWNlaG9sZGVyIGxvZ2dpbmcgdGFiIGZvciB0ZXN0aW5nYCxcclxuICAgICAgICAgICAgYENoYW5nZWQgZXh0ZW5zaW9uIHNjcmlwdCBsb2FkaW5nIHRvIHdvcmsgc29tZXdoYXQgbW9yZSBkeW5hbWljYWxseWAsXHJcbiAgICAgICAgXVxyXG4gICAgfSwge1xyXG4gICAgICAgIFwidmVyc2lvblwiOiBcImIwLjAuMVwiLFxyXG4gICAgICAgIFwiYnVsbGV0cG9pbnRzXCI6IFtcclxuICAgICAgICAgICAgYFBvcnRlZCBtb3N0IGZ1bmN0aW9uYWxpdHkgZnJvbSBUYW1wZXJtb25rZXkgc2NyaXB0IGxvY2F0ZWQgPGEgaHJlZj1cImh0dHBzOi8vZ2l0aHViLmNvbS9hbGJlcnQtc3VuL3RhbXBlci1zY3JpcHRzL1wiPmhlcmU8L2E+YCxcclxuICAgICAgICAgICAgYDxiPkZlYXR1cmVzIG5vdCB5ZXQgaW1wbGVtZW50ZWQ8L2I+OiBibGFja2xpc3RlZCBrZXl3b3JkcyBhbmQgYnV0dG9ucyBmb3IgdGVzdGluZyB3dGloaW4gc2V0dGluZ3MgKHJlbW92ZWQgdW50aWwgc2V0dGluZ3Mgc3RydWN0dXJlIGZpbmFsaXplZClgLFxyXG4gICAgICAgICAgICBgPGI+SW1wcm92ZW1lbnRzIGZyb20gVGFtcGVybW9ua2V5IHNjcmlwdDwvYj46IEluc3RhbnQgc2V0dGluZ3MgcHJvcG9nYXRpb24gYW5kIG5vIHJlZnJlc2ggcmVxdWlyZWQgZm9yIGNhcnQgYWRkaXRpb24gb3IgcmVtb3ZhbGBcclxuICAgICAgICBdXHJcbiAgICB9XHJcbl07XHJcbi8vIFNldHRpbmdzIGFjcm9zcyBhbGwgY2F0ZWdvcmllcyBmb3IgZXh0ZW5zaW9uXHJcbmV4cG9ydHMuZGVmYXVsdFNldHRpbmdzID0ge1xyXG4gICAgXCJiZXN0YnV5XCI6IFtcclxuICAgICAgICB7IGtleTogXCJhdXRvbWF0aWNRdWV1ZUZpeFwiLCBkZXNjcmlwdGlvbjogXCJBdHRlbXB0IHRvIGF1dG9tYXRpY2FsbHkgZml4IGJyb2tlbiBxdWV1ZXNcIiwgdHlwZTogXCJzbGlkZVN3aXRjaFwiLCB2YWx1ZTogdHJ1ZSB9LFxyXG4gICAgICAgIHsga2V5OiBcImF1dG9DbGlja1doaXRlbGlzdGVkXCIsIGRlc2NyaXB0aW9uOiBcIkF1dG9tYXRpY2FsbHkgY2xpY2sgd2hpdGVsaXN0ZWQgQVRDIGJ1dHRvbnNcIiwgdHlwZTogXCJzbGlkZVN3aXRjaFwiLCB2YWx1ZTogdHJ1ZSB9LFxyXG4gICAgICAgIHsga2V5OiBcInN0b3BDbGlja0NhcnRPY2N1cGllZFwiLCBkZXNjcmlwdGlvbjogXCJTdG9wIGF1dG9tYXRpYyBjbGlja2luZyB3aGVuIGNhcnQgb2NjdXBpZWRcIiwgdHlwZTogXCJzbGlkZVN3aXRjaFwiLCB2YWx1ZTogdHJ1ZSB9LFxyXG4gICAgICAgIHsga2V5OiBcImdsb2JhbFBvbGxpbmdJbnRlcnZhbFwiLCBkZXNjcmlwdGlvbjogXCJHbG9iYWwgY29udGVudCBzY3JpcHQgcG9sbGluZyBpbnRlcnZhbFwiLCB0eXBlOiBcIm51bWJlclwiLCBleHRyYVRleHQ6IFwibXNcIiwgdmFsdWU6IDEwMCB9LFxyXG4gICAgICAgIHsga2V5OiBcInN1Y2Nlc3NpdmVDbGlja1RpbWVvdXRcIiwgZGVzY3JpcHRpb246IFwiVGltZW91dCBiZXR3ZWVuIGNsaWNraW5nIHVuaXF1ZSBidXR0b25zXCIsIHR5cGU6IFwibnVtYmVyXCIsIGV4dHJhVGV4dDogXCJtc1wiLCB2YWx1ZTogMjUwMCB9LFxyXG4gICAgICAgIHsga2V5OiBcIm5vdGlmaWNhdGlvblNvdW5kVVJMXCIsIGRlc2NyaXB0aW9uOiBcIk5vdGlmaWNhdGlvbiBzb3VuZCBVUkwgKG1wMyBob3RsaW5rKVwiLCB0eXBlOiBcInRleHRcIiwgdmFsdWU6IFwiaHR0cHM6Ly9naXRodWIuY29tL2FsYmVydC1zdW4vdGFtcGVyLXNjcmlwdHMvYmxvYi9tYWluL3Jlc291cmNlcy9ub3RpZmljYXRpb24ubXAzP3Jhdz10cnVlXCIgfSxcclxuICAgICAgICB7IGtleTogXCJ3aGl0ZWxpc3RlZEtleXdvcmRzXCIsIGRlc2NyaXB0aW9uOiBcIldoaXRlbGlzdGVkIGtleXdvcmRzIChjb21tYS1zZXBhcmF0ZWQpXCIsIHR5cGU6IFwidGV4dFwiLCB2YWx1ZTogXCIzMDYwLDMwNjB0aSwzMDYwIHRpLDMwNzAsMzA3MHRpLDMwNzAgdGksMzA4MCwzMDgwdGksMzA4MCB0aSwzMDkwXCIgfSxcclxuICAgICAgICB7IGtleTogXCJibGFja2xpc3RlZEtleXdvcmRzXCIsIGRlc2NyaXB0aW9uOiBcIkJsYWNrbGlzdGVkIGtleXdvcmRzIChjb21tYS1zZXBhcmF0ZWQpXCIsIHR5cGU6IFwidGV4dFwiLCB2YWx1ZTogXCJcIiB9LFxyXG4gICAgICAgIC8vIHsga2V5OiBcInRlc3ROb3RpZmljYXRpb25Tb3VuZFwiLCBkZXNjcmlwdGlvbjogXCJQbGF5IGN1cnJlbnQgbm90aWZpY2F0aW9uIHNvdW5kXCIsIHR5cGU6IFwiYnV0dG9uXCIsIGluc3RydWN0aW9uOiBcInRlc3ROb3RpZmljYXRpb25Tb3VuZFwiIH0sXHJcbiAgICBdXHJcbn07XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5yZXRyaWV2ZVNldHRpbmdzS1YgPSBleHBvcnRzLnJldHJpZXZlU2V0dGluZ3MgPSBleHBvcnRzLnN0b3JhZ2VHZXQgPSBleHBvcnRzLmVsZW1lbnRDb2xvciA9IGV4cG9ydHMuc2xlZXAgPSB2b2lkIDA7XHJcbmNvbnN0IHdlYmV4dGVuc2lvbl9wb2x5ZmlsbF90c18xID0gcmVxdWlyZShcIndlYmV4dGVuc2lvbi1wb2x5ZmlsbC10c1wiKTtcclxuY29uc3QgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XHJcbi8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzk1MTAyMS93aGF0LWlzLXRoZS1qYXZhc2NyaXB0LXZlcnNpb24tb2Ytc2xlZXBcclxuLy8gUG9zc2libHkgaGFzIGlzc3VlcyByZXNvbHZpbmcgb24gRmlyZWZveD8gU3RhY2tPdmVyZmxvdyBzdXJlIGRvZXNuJ3QgdGhpbmsgc28uLi5cclxuZnVuY3Rpb24gc2xlZXAobXMpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcclxufVxyXG5leHBvcnRzLnNsZWVwID0gc2xlZXA7XHJcbi8vIEFwcHJveGltYXRlcyB0aGUgcmVuZGVyZWQgYmFja2dyb3VuZCBjb2xvciBvZiBhIGdpdmVuIGVsZW1lbnQgdG8gYSBnaXZlbiBzZXQgb2YgY29sb3JzLlxyXG4vLyBDaGVja3Mgd2hldGhlciB0aGUgXCJkaXN0YW5jZVwiIGZyb20gdGhlIGVsZW1lbnQgY29sb3IgaXMgdHJhbnNwYXJlbnQgb3IgY2xvc2VzdCB0byBlaXRoZXIgeWVsbG93L3doaXRlL2JsdWUuXHJcbmNvbnN0IGNvbG9ycyA9IFtcclxuICAgIHsgY29sb3I6IFwieWVsbG93XCIsIHI6IDI1NSwgZzogMjI0LCBiOiAwIH0sXHJcbiAgICB7IGNvbG9yOiBcImJsdWVcIiwgcjogMCwgZzogMzAsIGI6IDExNSB9LFxyXG4gICAgeyBjb2xvcjogXCJncmV5XCIsIHI6IDE5NywgZzogMjAzLCBiOiAyMTMgfSxcclxuICAgIHsgY29sb3I6IFwid2hpdGVcIiwgcjogMjU1LCBnOiAyNTUsIGI6IDI1NSB9LFxyXG5dO1xyXG5mdW5jdGlvbiBlbGVtZW50Q29sb3IoZWxlbWVudCkge1xyXG4gICAgLy8gR2V0IHRoZSByZW5kZXJlZCBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBlbGVtZW50XHJcbiAgICBjb25zdCBjb2xvclRleHQgPSBnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIG51bGwpLmdldFByb3BlcnR5VmFsdWUoXCJiYWNrZ3JvdW5kLWNvbG9yXCIpO1xyXG4gICAgaWYgKGNvbG9yVGV4dC5pbmNsdWRlcyhcInJnYigwLCAwLCAwXCIpKSB7IC8vIGVsZW1lbnQgaGFzIG5vIGNvbG9yID0gdHJhbnNwYXJlbnRcclxuICAgICAgICByZXR1cm4gXCJ0cmFuc3BhcmVudFwiO1xyXG4gICAgfVxyXG4gICAgLy8gUGFyc2UgUkdCIHZhbHVlIGFuZCB1c2UgZmFuY3kgbWF0aHMgdG8gZmluZCBjbG9zZXN0IGNvbG9yXHJcbiAgICBjb25zdCBwYXJzZWRDb2xvciA9IHsgcjogMCwgZzogMCwgYjogMCB9O1xyXG4gICAgY29uc3QgbWF0Y2hlZENvbG9yID0gY29sb3JUZXh0Lm1hdGNoKC9ecmdiXFxzKlxcKFxccyooXFxkKylcXHMqLFxccyooXFxkKylcXHMqLFxccyooXFxkKylcXHMqXFwpJC9pKTtcclxuICAgIHBhcnNlZENvbG9yLnIgPSBOdW1iZXIobWF0Y2hlZENvbG9yWzFdKTtcclxuICAgIHBhcnNlZENvbG9yLmcgPSBOdW1iZXIobWF0Y2hlZENvbG9yWzJdKTtcclxuICAgIHBhcnNlZENvbG9yLmIgPSBOdW1iZXIobWF0Y2hlZENvbG9yWzNdKTtcclxuICAgIGNvbnN0IGNsb3Nlc3QgPSB7IGNvbG9yOiBcIlwiLCBkaXN0YW5jZTogNDQyIH07IC8vIERlZmF1bHQgZGlzdGFuY2UganVzdCBzbGlnaHRseSBsYXJnZXIgdGhhbiBtYXhcclxuICAgIGZvciAoY29uc3QgY2hlY2tDb2xvciBvZiBjb2xvcnMpIHtcclxuICAgICAgICBjb25zdCBkaXN0YW5jZSA9IE1hdGguc3FydChNYXRoLnBvdygocGFyc2VkQ29sb3IuciAtIGNoZWNrQ29sb3IuciksIDIpICsgTWF0aC5wb3coKHBhcnNlZENvbG9yLmcgLSBjaGVja0NvbG9yLmcpLCAyKSArIChwYXJzZWRDb2xvci5iIC0gY2hlY2tDb2xvci5iKSk7XHJcbiAgICAgICAgaWYgKGRpc3RhbmNlIDwgY2xvc2VzdC5kaXN0YW5jZSkge1xyXG4gICAgICAgICAgICBjbG9zZXN0LmNvbG9yID0gY2hlY2tDb2xvci5jb2xvcjtcclxuICAgICAgICAgICAgY2xvc2VzdC5kaXN0YW5jZSA9IGRpc3RhbmNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBjbG9zZXN0LmNvbG9yO1xyXG59XHJcbmV4cG9ydHMuZWxlbWVudENvbG9yID0gZWxlbWVudENvbG9yO1xyXG4vLyBXcmFwcGVyIGZvciByZXRyaWV2aW5nIGZyb20gc3RvcmFnZSB3aXRoIGRlZmF1bHQgdmFsdWUgaWYgdW5kZWZpbmVkXHJcbmZ1bmN0aW9uIHN0b3JhZ2VHZXQoc3RvcmFnZUtleSwgZGVmYXVsdFZhbHVlKSB7XHJcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xyXG4gICAgICAgIGNvbnN0IHN0b3JhZ2VSZXN1bHQgPSB5aWVsZCB3ZWJleHRlbnNpb25fcG9seWZpbGxfdHNfMS5icm93c2VyLnN0b3JhZ2UubG9jYWwuZ2V0KHN0b3JhZ2VLZXkpO1xyXG4gICAgICAgIHJldHVybiBzdG9yYWdlUmVzdWx0W3N0b3JhZ2VLZXldICE9PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgPyBzdG9yYWdlUmVzdWx0W3N0b3JhZ2VLZXldIDogZGVmYXVsdFZhbHVlO1xyXG4gICAgfSk7XHJcbn1cclxuZXhwb3J0cy5zdG9yYWdlR2V0ID0gc3RvcmFnZUdldDtcclxuLy8gV3JhcHBlciBmb3IgcmV0cmlldmluZyBzZXR0aW5ncyBmb3IgZ2l2ZW4gY2F0ZWdvcnkgYnkgdXBkYXRpbmcgZnJvbSBTdG9yYWdlIEFQSVxyXG5mdW5jdGlvbiByZXRyaWV2ZVNldHRpbmdzKHNldHRpbmdzQ2F0ZWdvcnkpIHtcclxuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgLy8gR2V0IGRlZmF1bHQgc2V0dGluZ3MsIHRoZW4gdXBkYXRlIGluZGl2aWR1YWwgc2V0dGluZ3MgZnJvbSBTdG9yYWdlIEFQSVxyXG4gICAgICAgIGNvbnN0IGNhdGVnb3J5U2V0dGluZ3MgPSBjb25zdGFudHNfMS5kZWZhdWx0U2V0dGluZ3Nbc2V0dGluZ3NDYXRlZ29yeV07XHJcbiAgICAgICAgZm9yIChjb25zdCBzZXR0aW5nIG9mIGNhdGVnb3J5U2V0dGluZ3MpIHtcclxuICAgICAgICAgICAgLy8gSWdub3JlIHNldHRpbmdzIHdpdGhvdXQgYSB2YWx1ZSAoYnV0dG9ucyBtYWlubHkpXHJcbiAgICAgICAgICAgIGlmIChzZXR0aW5nLnZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFJlcGxhY2Ugd2l0aCB2YWx1ZSBmcm9tIHN0b3JhZ2UgaWYgbW9kaWZpZWQgZXhpc3RzLCBvdGhlcndpc2Uga2VlcCBkZWZhdWx0XHJcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdLZXkgPSBgc2V0dGluZy0ke3NldHRpbmdzQ2F0ZWdvcnl9LSR7c2V0dGluZy5rZXl9YDtcclxuICAgICAgICAgICAgc2V0dGluZy52YWx1ZSA9IHlpZWxkIHN0b3JhZ2VHZXQoc2V0dGluZ0tleSwgc2V0dGluZy52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjYXRlZ29yeVNldHRpbmdzO1xyXG4gICAgfSk7XHJcbn1cclxuZXhwb3J0cy5yZXRyaWV2ZVNldHRpbmdzID0gcmV0cmlldmVTZXR0aW5ncztcclxuLy8gV3JhcHBlciBmb3IgZm9ybWF0dGluZyB0aGUgc2V0dGluZ3MgaW50byBrZXktdmFsdWUgaW5zdGVhZCBvZiBhcnJheVxyXG5mdW5jdGlvbiByZXRyaWV2ZVNldHRpbmdzS1Yoc2V0dGluZ3NDYXRlZ29yeSkge1xyXG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICBjb25zdCBjYXRlZ29yeVNldHRpbmdzS1YgPSB7fTtcclxuICAgICAgICBjb25zdCBjYXRlZ29yeVNldHRpbmdzID0geWllbGQgcmV0cmlldmVTZXR0aW5ncyhzZXR0aW5nc0NhdGVnb3J5KTsgLy8gR2V0IHNldHRpbmdzIGJlZm9yZSByZWZvcm1hdHRpbmdcclxuICAgICAgICBmb3IgKGNvbnN0IHNldHRpbmcgb2YgY2F0ZWdvcnlTZXR0aW5ncykge1xyXG4gICAgICAgICAgICAvLyBJZ25vcmUgc2V0dGluZ3Mgd2l0aG91dCBhIHZhbHVlIChidXR0b25zIG1haW5seSlcclxuICAgICAgICAgICAgaWYgKHNldHRpbmcudmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0ZWdvcnlTZXR0aW5nc0tWW3NldHRpbmcua2V5XSA9IHNldHRpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjYXRlZ29yeVNldHRpbmdzS1Y7XHJcbiAgICB9KTtcclxufVxyXG5leHBvcnRzLnJldHJpZXZlU2V0dGluZ3NLViA9IHJldHJpZXZlU2V0dGluZ3NLVjtcclxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbi8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBfX3dlYnBhY2tfbW9kdWxlc19fO1xuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uaiA9IDg0MzsiLCIvLyBubyBiYXNlVVJJXG5cbi8vIG9iamVjdCB0byBzdG9yZSBsb2FkZWQgYW5kIGxvYWRpbmcgY2h1bmtzXG4vLyB1bmRlZmluZWQgPSBjaHVuayBub3QgbG9hZGVkLCBudWxsID0gY2h1bmsgcHJlbG9hZGVkL3ByZWZldGNoZWRcbi8vIFtyZXNvbHZlLCByZWplY3QsIFByb21pc2VdID0gY2h1bmsgbG9hZGluZywgMCA9IGNodW5rIGxvYWRlZFxudmFyIGluc3RhbGxlZENodW5rcyA9IHtcblx0ODQzOiAwLFxuXHQ1MzM6IDAsXG5cdDM4NjogMFxufTtcblxuLy8gbm8gY2h1bmsgb24gZGVtYW5kIGxvYWRpbmdcblxuLy8gbm8gcHJlZmV0Y2hpbmdcblxuLy8gbm8gcHJlbG9hZGVkXG5cbi8vIG5vIEhNUlxuXG4vLyBubyBITVIgbWFuaWZlc3RcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5PLmogPSAoY2h1bmtJZCkgPT4gKGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9PT0gMCk7XG5cbi8vIGluc3RhbGwgYSBKU09OUCBjYWxsYmFjayBmb3IgY2h1bmsgbG9hZGluZ1xudmFyIHdlYnBhY2tKc29ucENhbGxiYWNrID0gKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uLCBkYXRhKSA9PiB7XG5cdHZhciBbY2h1bmtJZHMsIG1vcmVNb2R1bGVzLCBydW50aW1lXSA9IGRhdGE7XG5cdC8vIGFkZCBcIm1vcmVNb2R1bGVzXCIgdG8gdGhlIG1vZHVsZXMgb2JqZWN0LFxuXHQvLyB0aGVuIGZsYWcgYWxsIFwiY2h1bmtJZHNcIiBhcyBsb2FkZWQgYW5kIGZpcmUgY2FsbGJhY2tcblx0dmFyIG1vZHVsZUlkLCBjaHVua0lkLCBpID0gMDtcblx0Zm9yKG1vZHVsZUlkIGluIG1vcmVNb2R1bGVzKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKG1vcmVNb2R1bGVzLCBtb2R1bGVJZCkpIHtcblx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubVttb2R1bGVJZF0gPSBtb3JlTW9kdWxlc1ttb2R1bGVJZF07XG5cdFx0fVxuXHR9XG5cdGlmKHJ1bnRpbWUpIHZhciByZXN1bHQgPSBydW50aW1lKF9fd2VicGFja19yZXF1aXJlX18pO1xuXHRpZihwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbikgcGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24oZGF0YSk7XG5cdGZvcig7aSA8IGNodW5rSWRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0Y2h1bmtJZCA9IGNodW5rSWRzW2ldO1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpICYmIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSkge1xuXHRcdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdWzBdKCk7XG5cdFx0fVxuXHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkc1tpXV0gPSAwO1xuXHR9XG5cdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fLk8ocmVzdWx0KTtcbn1cblxudmFyIGNodW5rTG9hZGluZ0dsb2JhbCA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmtleHRlbnNpb25cIl0gPSBzZWxmW1wid2VicGFja0NodW5rZXh0ZW5zaW9uXCJdIHx8IFtdO1xuY2h1bmtMb2FkaW5nR2xvYmFsLmZvckVhY2god2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCAwKSk7XG5jaHVua0xvYWRpbmdHbG9iYWwucHVzaCA9IHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2guYmluZChjaHVua0xvYWRpbmdHbG9iYWwpKTsiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGRlcGVuZHMgb24gb3RoZXIgbG9hZGVkIGNodW5rcyBhbmQgZXhlY3V0aW9uIG5lZWQgdG8gYmUgZGVsYXllZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8odW5kZWZpbmVkLCBbNzM2XSwgKCkgPT4gKF9fd2VicGFja19yZXF1aXJlX18oOTcwNSkpKVxuX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyhfX3dlYnBhY2tfZXhwb3J0c19fKTtcbiJdLCJzb3VyY2VSb290IjoiIn0=